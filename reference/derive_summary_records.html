<!-- Generated by pkgdown: do not edit by hand -->
<!DOCTYPE html>
<html lang="en">
  <head>
  <meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<title>Add New Records Within By Groups Using Aggregation Functions — derive_summary_records • admiral</title>

<!-- favicons -->
<link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png" />
<link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png" />
<link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png" />
<link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png" />

<!-- jquery -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script>
<!-- Bootstrap -->
<link href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.4.0/flatly/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous" />


<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script>

<!-- bootstrap-toc -->
<link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script>

<!-- Font Awesome icons -->
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous" />
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous" />

<!-- clipboard.js -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script>

<!-- headroom.js -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script>

<!-- pkgdown -->
<link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script>




<meta property="og:title" content="Add New Records Within By Groups Using Aggregation Functions — derive_summary_records" />
<meta property="og:description" content="It is not uncommon to have an analysis need whereby one needs to derive an
analysis value (AVAL) from multiple records. The ADaM basic dataset
structure variable DTYPE is available to indicate when a new derived
records has been added to a dataset." />
<meta property="og:image" content="/logo.png" />




<!-- mathjax -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script>

<!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->



  </head>

  <body data-spy="scroll" data-target="#toc">
    <div class="container template-reference-topic">
      <header>
      <div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">admiral</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">0.2.0</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
        <li>
  <a href="../index.html">
    <span class="fas fa fas fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../articles/admiral.html">Get started</a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li>
      <a href="../articles/adsl.html">Creating ADSL</a>
    </li>
    <li>
      <a href="../articles/occds.html">Creating an OCCDS ADaM</a>
    </li>
    <li>
      <a href="../articles/bds_finding.html">Creating a BDS Finding ADaM</a>
    </li>
    <li>
      <a href="../articles/contributing.html">Contributing to admiral</a>
    </li>
    <li>
      <a href="../articles/faq.html">FAQ</a>
    </li>
  </ul>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul>
      <ul class="nav navbar-nav navbar-right">
        <li>
  <a href="https://github.com/Roche-GSK/admiral/">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
      
    </div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

      

      </header>

<div class="row">
  <div class="col-md-9 contents">
    <div class="page-header">
    <h1>Add New Records Within By Groups Using Aggregation Functions</h1>
    <small class="dont-index">Source: <a href='https://github.com/Roche-GSK/admiral/blob/master/R/derive_summary_records.R'><code>R/derive_summary_records.R</code></a></small>
    <div class="hidden name"><code>derive_summary_records.Rd</code></div>
    </div>

    <div class="ref-description">
    <p>It is not uncommon to have an analysis need whereby one needs to derive an
analysis value (<code>AVAL</code>) from multiple records. The ADaM basic dataset
structure variable <code>DTYPE</code> is available to indicate when a new derived
records has been added to a dataset.</p>
    </div>

    <pre class="usage"><span class='fu'>derive_summary_records</span>(
  <span class='no'>dataset</span>,
  <span class='no'>by_vars</span>,
  <span class='no'>fns</span>,
  <span class='kw'>filter_rows</span> <span class='kw'>=</span> <span class='kw'>NULL</span>,
  <span class='kw'>set_values_to</span> <span class='kw'>=</span> <span class='kw'>NULL</span>,
  <span class='kw'>drop_values_from</span> <span class='kw'>=</span> <span class='kw'>NULL</span>
)</pre>

    <h2 class="hasAnchor" id="arguments"><a class="anchor" href="#arguments"></a>Arguments</h2>
    <table class="ref-arguments">
    <colgroup><col class="name" /><col class="desc" /></colgroup>
    <tr>
      <th>dataset</th>
      <td><p>A data frame.</p></td>
    </tr>
    <tr>
      <th>by_vars</th>
      <td><p>Variables to consider for generation of groupwise summary
records. Providing the names of variables in <code><a href='https://dplyr.tidyverse.org/reference/vars.html'>vars()</a></code> will create a
groupwise summary and generate summary records for the specified groups.</p></td>
    </tr>
    <tr>
      <th>fns</th>
      <td><p>List of formulas specifying variable to use for aggregations.
This can include base functions like <code><a href='https://rdrr.io/r/base/mean.html'>mean()</a></code>, <code><a href='https://rdrr.io/r/base/Extremes.html'>min()</a></code>, <code><a href='https://rdrr.io/r/base/Extremes.html'>max()</a></code>, <code><a href='https://rdrr.io/r/stats/median.html'>median()</a></code>,
<code><a href='https://rdrr.io/r/stats/sd.html'>sd()</a></code>, or <code><a href='https://rdrr.io/r/base/sum.html'>sum()</a></code> or any other user-defined aggregation function.
For example,</p><ul>
<li><p>When a summary function is same for one or more analysis variable, use
<code>fns = list(vars(AVAL, CHG) ~ mean</code>).</p></li>
<li><p>If a different summary function is required for each analysis variable,
use <code>fns = list(AVAL ~ mean, CHG ~ sum(., na.rm = TRUE))</code>.</p></li>
</ul>

<p>In general,</p><ul>
<li><p>LHS refer to the one or more variable to use for summarizing.</p></li>
<li><p>RHS refer to a <strong>single</strong> summary function.</p></li>
</ul>

<p>In the formula representation e.g., <code>CHG ~ sum(., na.rm = TRUE)</code>, a <code>.</code>
serves as the data to be summarized which refers to the variable <code>CHG</code>.</p></td>
    </tr>
    <tr>
      <th>filter_rows</th>
      <td><p>Filter condition as logical expression to apply during
summary calculation. By default, filtering expressions are computed within
<code>by_vars</code> as this will help when an aggregating, lagging, or ranking
function is involved.</p>
<p>For example,</p><ul>
<li><p><code>filter_rows = (AVAL &gt; mean(AVAL, na.rm = TRUE))</code> will filter all AVAL
values greater than mean of AVAL with in <code>by_vars</code>.</p></li>
<li><p><code>filter_rows = (dplyr::n() &gt; 2)</code> will filter n count of <code>by_vars</code> greater
than 2.</p></li>
</ul></td>
    </tr>
    <tr>
      <th>set_values_to</th>
      <td><p>A list of variable name-value pairs. Use this argument
if you need to change the values of any newly derived records. Always new
values in <code>set_values_to</code> should be equal to the length of analysis
variable used in the <code>fns</code> argument. For example,</p><ul>
<li><p>On using single analysis variable in <code>fns = list(AVAL ~ mean)</code> and
<code>set_values_to = vars(AVISITN = 9999, AVISIT = "Endpoint")</code> would change
the value of <code>AVISITN</code> to <code>9999</code> and <code>AVISIT</code> to <code>Endpoint</code> instead of
retaining.</p></li>
<li><p>Multiple analysis variables in <code>fns = list(vars(AVAL, CHG) ~ mean)</code> and
<code>set_values_to = vars(AVISITN = c(9998, 9999))</code> would change <code>AVISITN</code> to
<code>9998</code> for <code>AVAL</code> and <code>AVISITN</code> to <code>9999</code> for <code>CHG</code>.</p></li>
</ul></td>
    </tr>
    <tr>
      <th>drop_values_from</th>
      <td><p>Providing the names of variables in <code><a href='https://dplyr.tidyverse.org/reference/vars.html'>vars()</a></code>
will drop values and set as missing.</p></td>
    </tr>
    </table>

    <h2 class="hasAnchor" id="value"><a class="anchor" href="#value"></a>Value</h2>

    <p>A data frame with derived records appended to original dataset.</p>
    <h2 class="hasAnchor" id="details"><a class="anchor" href="#details"></a>Details</h2>

    <p>When all records have same values within <code>by_vars</code> then this function will
retain those common values in the newly derived records. Otherwise new value
will be set to <code>NA</code>.</p>

    <h2 class="hasAnchor" id="examples"><a class="anchor" href="#examples"></a>Examples</h2>
    <pre class="examples"><div class='input'><span class='no'>adeg</span> <span class='kw'>&lt;-</span> <span class='kw pkg'>tibble</span><span class='kw ns'>::</span><span class='fu'><a href='https://tibble.tidyverse.org/reference/tribble.html'>tribble</a></span>(
  ~<span class='no'>USUBJID</span>, ~<span class='no'>EGSEQ</span>, ~<span class='no'>PARAM</span>,             ~<span class='no'>AVISIT</span>,    ~<span class='no'>EGDTC</span>,            ~<span class='no'>AVAL</span>, ~<span class='no'>TRTA</span>,
  <span class='st'>"XYZ-1001"</span>,    <span class='fl'>1</span>, <span class='st'>"QTcF Int. (msec)"</span>, <span class='st'>"Baseline"</span>, <span class='st'>"2016-02-24T07:50"</span>,  <span class='fl'>385</span>, <span class='st'>""</span>,
  <span class='st'>"XYZ-1001"</span>,    <span class='fl'>2</span>, <span class='st'>"QTcF Int. (msec)"</span>, <span class='st'>"Baseline"</span>, <span class='st'>"2016-02-24T07:52"</span>,  <span class='fl'>399</span>, <span class='st'>""</span>,
  <span class='st'>"XYZ-1001"</span>,    <span class='fl'>3</span>, <span class='st'>"QTcF Int. (msec)"</span>, <span class='st'>"Baseline"</span>, <span class='st'>"2016-02-24T07:56"</span>,  <span class='fl'>396</span>, <span class='st'>""</span>,
  <span class='st'>"XYZ-1001"</span>,    <span class='fl'>4</span>, <span class='st'>"QTcF Int. (msec)"</span>, <span class='st'>"Visit 2"</span>,  <span class='st'>"2016-03-08T09:45"</span>,  <span class='fl'>384</span>, <span class='st'>"Placebo"</span>,
  <span class='st'>"XYZ-1001"</span>,    <span class='fl'>5</span>, <span class='st'>"QTcF Int. (msec)"</span>, <span class='st'>"Visit 2"</span>,  <span class='st'>"2016-03-08T09:48"</span>,  <span class='fl'>393</span>, <span class='st'>"Placebo"</span>,
  <span class='st'>"XYZ-1001"</span>,    <span class='fl'>6</span>, <span class='st'>"QTcF Int. (msec)"</span>, <span class='st'>"Visit 2"</span>,  <span class='st'>"2016-03-08T09:51"</span>,  <span class='fl'>388</span>, <span class='st'>"Placebo"</span>,
  <span class='st'>"XYZ-1001"</span>,    <span class='fl'>7</span>, <span class='st'>"QTcF Int. (msec)"</span>, <span class='st'>"Visit 3"</span>,  <span class='st'>"2016-03-22T10:45"</span>,  <span class='fl'>385</span>, <span class='st'>"Placebo"</span>,
  <span class='st'>"XYZ-1001"</span>,    <span class='fl'>8</span>, <span class='st'>"QTcF Int. (msec)"</span>, <span class='st'>"Visit 3"</span>,  <span class='st'>"2016-03-22T10:48"</span>,  <span class='fl'>394</span>, <span class='st'>"Placebo"</span>,
  <span class='st'>"XYZ-1001"</span>,    <span class='fl'>9</span>, <span class='st'>"QTcF Int. (msec)"</span>, <span class='st'>"Visit 3"</span>,  <span class='st'>"2016-03-22T10:51"</span>,  <span class='fl'>402</span>, <span class='st'>"Placebo"</span>,
  <span class='st'>"XYZ-1002"</span>,    <span class='fl'>1</span>, <span class='st'>"QTcF Int. (msec)"</span>, <span class='st'>"Baseline"</span>, <span class='st'>"2016-02-22T07:58"</span>,  <span class='fl'>399</span>, <span class='st'>""</span>,
  <span class='st'>"XYZ-1002"</span>,    <span class='fl'>2</span>, <span class='st'>"QTcF Int. (msec)"</span>, <span class='st'>"Baseline"</span>, <span class='st'>"2016-02-22T07:58"</span>,  <span class='fl'>410</span>, <span class='st'>""</span>,
  <span class='st'>"XYZ-1002"</span>,    <span class='fl'>3</span>, <span class='st'>"QTcF Int. (msec)"</span>, <span class='st'>"Baseline"</span>, <span class='st'>"2016-02-22T08:01"</span>,  <span class='fl'>392</span>, <span class='st'>""</span>,
  <span class='st'>"XYZ-1002"</span>,    <span class='fl'>4</span>, <span class='st'>"QTcF Int. (msec)"</span>, <span class='st'>"Visit 2"</span>,  <span class='st'>"2016-03-06T09:50"</span>,  <span class='fl'>401</span>, <span class='st'>"Active 20mg"</span>,
  <span class='st'>"XYZ-1002"</span>,    <span class='fl'>5</span>, <span class='st'>"QTcF Int. (msec)"</span>, <span class='st'>"Visit 2"</span>,  <span class='st'>"2016-03-06T09:53"</span>,  <span class='fl'>407</span>, <span class='st'>"Active 20mg"</span>,
  <span class='st'>"XYZ-1002"</span>,    <span class='fl'>6</span>, <span class='st'>"QTcF Int. (msec)"</span>, <span class='st'>"Visit 2"</span>,  <span class='st'>"2016-03-06T09:56"</span>,  <span class='fl'>400</span>, <span class='st'>"Active 20mg"</span>,
  <span class='st'>"XYZ-1002"</span>,    <span class='fl'>7</span>, <span class='st'>"QTcF Int. (msec)"</span>, <span class='st'>"Visit 3"</span>,  <span class='st'>"2016-03-24T10:50"</span>,  <span class='fl'>412</span>, <span class='st'>"Active 20mg"</span>,
  <span class='st'>"XYZ-1002"</span>,    <span class='fl'>8</span>, <span class='st'>"QTcF Int. (msec)"</span>, <span class='st'>"Visit 3"</span>,  <span class='st'>"2016-03-24T10:53"</span>,  <span class='fl'>414</span>, <span class='st'>"Active 20mg"</span>,
  <span class='st'>"XYZ-1002"</span>,    <span class='fl'>9</span>, <span class='st'>"QTcF Int. (msec)"</span>, <span class='st'>"Visit 3"</span>,  <span class='st'>"2016-03-24T10:56"</span>,  <span class='fl'>402</span>, <span class='st'>"Active 20mg"</span>,
)

<span class='co'># Summarize the average of the triplicate ECG interval values (AVAL)</span>
<span class='fu'>derive_summary_records</span>(
  <span class='no'>adeg</span>,
  <span class='kw'>by_vars</span> <span class='kw'>=</span> <span class='fu'><a href='https://dplyr.tidyverse.org/reference/vars.html'>vars</a></span>(<span class='no'>USUBJID</span>, <span class='no'>PARAM</span>, <span class='no'>AVISIT</span>),
  <span class='kw'>fns</span> <span class='kw'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/list.html'>list</a></span>(<span class='no'>AVAL</span> ~ <span class='fu'><a href='https://rdrr.io/r/base/mean.html'>mean</a></span>(<span class='no'>.</span>, <span class='kw'>na.rm</span> <span class='kw'>=</span> <span class='fl'>TRUE</span>)),
  <span class='kw'>set_values_to</span> <span class='kw'>=</span> <span class='fu'><a href='https://dplyr.tidyverse.org/reference/vars.html'>vars</a></span>(<span class='kw'>DTYPE</span> <span class='kw'>=</span> <span class='st'>"AVERAGE"</span>)
)</div><div class='output co'>#&gt; # A tibble: 24 x 8
#&gt;    USUBJID  EGSEQ PARAM           AVISIT   EGDTC            AVAL TRTA     DTYPE 
#&gt;    &lt;chr&gt;    &lt;dbl&gt; &lt;chr&gt;           &lt;chr&gt;    &lt;chr&gt;           &lt;dbl&gt; &lt;chr&gt;    &lt;chr&gt; 
#&gt;  1 XYZ-1001     1 QTcF Int. (mse… Baseline 2016-02-24T07:…  385  ""       &lt;NA&gt;  
#&gt;  2 XYZ-1001     2 QTcF Int. (mse… Baseline 2016-02-24T07:…  399  ""       &lt;NA&gt;  
#&gt;  3 XYZ-1001     3 QTcF Int. (mse… Baseline 2016-02-24T07:…  396  ""       &lt;NA&gt;  
#&gt;  4 XYZ-1001    NA QTcF Int. (mse… Baseline &lt;NA&gt;             393. ""       AVERA…
#&gt;  5 XYZ-1001     4 QTcF Int. (mse… Visit 2  2016-03-08T09:…  384  "Placeb… &lt;NA&gt;  
#&gt;  6 XYZ-1001     5 QTcF Int. (mse… Visit 2  2016-03-08T09:…  393  "Placeb… &lt;NA&gt;  
#&gt;  7 XYZ-1001     6 QTcF Int. (mse… Visit 2  2016-03-08T09:…  388  "Placeb… &lt;NA&gt;  
#&gt;  8 XYZ-1001    NA QTcF Int. (mse… Visit 2  &lt;NA&gt;             388. "Placeb… AVERA…
#&gt;  9 XYZ-1001     7 QTcF Int. (mse… Visit 3  2016-03-22T10:…  385  "Placeb… &lt;NA&gt;  
#&gt; 10 XYZ-1001     8 QTcF Int. (mse… Visit 3  2016-03-22T10:…  394  "Placeb… &lt;NA&gt;  
#&gt; # … with 14 more rows</div><div class='input'>
<span class='no'>advs</span> <span class='kw'>&lt;-</span> <span class='kw pkg'>tibble</span><span class='kw ns'>::</span><span class='fu'><a href='https://tibble.tidyverse.org/reference/tribble.html'>tribble</a></span>(
  ~<span class='no'>USUBJID</span>,     ~<span class='no'>VSSEQ</span>, ~<span class='no'>PARAM</span>,  ~<span class='no'>AVAL</span>, ~<span class='no'>VSSTRESU</span>, ~<span class='no'>VISIT</span>,      ~<span class='no'>VSDTC</span>,
  <span class='st'>"XYZ-001-001"</span>,  <span class='fl'>1164</span>, <span class='st'>"Weight"</span>,   <span class='fl'>99</span>, <span class='st'>"kg"</span>,      <span class='st'>"Screening"</span>, <span class='st'>"2018-03-19"</span>,
  <span class='st'>"XYZ-001-001"</span>,  <span class='fl'>1165</span>, <span class='st'>"Weight"</span>,  <span class='fl'>101</span>, <span class='st'>"kg"</span>,      <span class='st'>"Run-In"</span>   , <span class='st'>"2018-03-26"</span>,
  <span class='st'>"XYZ-001-001"</span>,  <span class='fl'>1166</span>, <span class='st'>"Weight"</span>,  <span class='fl'>100</span>, <span class='st'>"kg"</span>,      <span class='st'>"Baseline"</span> , <span class='st'>"2018-04-16"</span>,
  <span class='st'>"XYZ-001-001"</span>,  <span class='fl'>1167</span>, <span class='st'>"Weight"</span>,   <span class='fl'>94</span>, <span class='st'>"kg"</span>,      <span class='st'>"Week 24"</span>  , <span class='st'>"2018-09-30"</span>,
  <span class='st'>"XYZ-001-001"</span>,  <span class='fl'>1168</span>, <span class='st'>"Weight"</span>,   <span class='fl'>92</span>, <span class='st'>"kg"</span>,      <span class='st'>"Week 48"</span>  , <span class='st'>"2019-03-17"</span>,
  <span class='st'>"XYZ-001-001"</span>,  <span class='fl'>1169</span>, <span class='st'>"Weight"</span>,   <span class='fl'>95</span>, <span class='st'>"kg"</span>,      <span class='st'>"Week 52"</span>  , <span class='st'>"2019-04-14"</span>,
)

<span class='co'># Set new values to any variable. Here, `DTYPE = MAXIMUM` refers to `max()` records</span>
<span class='co'># and `DTYPE = AVERAGE` refers to `mean()` records.</span>
<span class='co'># `set_values_to` must be of the same length as `fns`</span>
<span class='fu'>derive_summary_records</span>(
  <span class='no'>advs</span>,
  <span class='kw'>by_vars</span> <span class='kw'>=</span> <span class='fu'><a href='https://dplyr.tidyverse.org/reference/vars.html'>vars</a></span>(<span class='no'>USUBJID</span>, <span class='no'>PARAM</span>),
  <span class='kw'>fns</span> <span class='kw'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/list.html'>list</a></span>(<span class='no'>AVAL</span> ~ <span class='no'>max</span>, <span class='no'>AVAL</span> ~ <span class='no'>mean</span>),
  <span class='kw'>set_values_to</span> <span class='kw'>=</span> <span class='fu'><a href='https://dplyr.tidyverse.org/reference/vars.html'>vars</a></span>(<span class='kw'>DTYPE</span> <span class='kw'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span>(<span class='st'>"MAXIMUM"</span>, <span class='st'>"AVERAGE"</span>))
)</div><div class='output co'>#&gt; # A tibble: 8 x 8
#&gt;   USUBJID     VSSEQ PARAM   AVAL VSSTRESU VISIT     VSDTC      DTYPE  
#&gt;   &lt;chr&gt;       &lt;dbl&gt; &lt;chr&gt;  &lt;dbl&gt; &lt;chr&gt;    &lt;chr&gt;     &lt;chr&gt;      &lt;chr&gt;  
#&gt; 1 XYZ-001-001  1164 Weight  99   kg       Screening 2018-03-19 &lt;NA&gt;   
#&gt; 2 XYZ-001-001  1165 Weight 101   kg       Run-In    2018-03-26 &lt;NA&gt;   
#&gt; 3 XYZ-001-001  1166 Weight 100   kg       Baseline  2018-04-16 &lt;NA&gt;   
#&gt; 4 XYZ-001-001  1167 Weight  94   kg       Week 24   2018-09-30 &lt;NA&gt;   
#&gt; 5 XYZ-001-001  1168 Weight  92   kg       Week 48   2019-03-17 &lt;NA&gt;   
#&gt; 6 XYZ-001-001  1169 Weight  95   kg       Week 52   2019-04-14 &lt;NA&gt;   
#&gt; 7 XYZ-001-001    NA Weight 101   kg       &lt;NA&gt;      &lt;NA&gt;       MAXIMUM
#&gt; 8 XYZ-001-001    NA Weight  96.8 kg       &lt;NA&gt;      &lt;NA&gt;       AVERAGE</div><div class='input'>
<span class='co'># Drop retained value of VSSTRESU in the derived record</span>
<span class='fu'>derive_summary_records</span>(
  <span class='no'>advs</span>,
  <span class='kw'>by_vars</span> <span class='kw'>=</span> <span class='fu'><a href='https://dplyr.tidyverse.org/reference/vars.html'>vars</a></span>(<span class='no'>USUBJID</span>, <span class='no'>PARAM</span>),
  <span class='kw'>fns</span> <span class='kw'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/list.html'>list</a></span>(<span class='no'>AVAL</span> ~ <span class='no'>mean</span>),
  <span class='kw'>set_values_to</span> <span class='kw'>=</span> <span class='fu'><a href='https://dplyr.tidyverse.org/reference/vars.html'>vars</a></span>(<span class='kw'>DTYPE</span> <span class='kw'>=</span> <span class='st'>"MAXIMUM"</span>),
  <span class='kw'>drop_values_from</span> <span class='kw'>=</span> <span class='fu'><a href='https://dplyr.tidyverse.org/reference/vars.html'>vars</a></span>(<span class='no'>VSSTRESU</span>)
)</div><div class='output co'>#&gt; # A tibble: 7 x 8
#&gt;   USUBJID     VSSEQ PARAM   AVAL VSSTRESU VISIT     VSDTC      DTYPE  
#&gt;   &lt;chr&gt;       &lt;dbl&gt; &lt;chr&gt;  &lt;dbl&gt; &lt;chr&gt;    &lt;chr&gt;     &lt;chr&gt;      &lt;chr&gt;  
#&gt; 1 XYZ-001-001  1164 Weight  99   kg       Screening 2018-03-19 &lt;NA&gt;   
#&gt; 2 XYZ-001-001  1165 Weight 101   kg       Run-In    2018-03-26 &lt;NA&gt;   
#&gt; 3 XYZ-001-001  1166 Weight 100   kg       Baseline  2018-04-16 &lt;NA&gt;   
#&gt; 4 XYZ-001-001  1167 Weight  94   kg       Week 24   2018-09-30 &lt;NA&gt;   
#&gt; 5 XYZ-001-001  1168 Weight  92   kg       Week 48   2019-03-17 &lt;NA&gt;   
#&gt; 6 XYZ-001-001  1169 Weight  95   kg       Week 52   2019-04-14 &lt;NA&gt;   
#&gt; 7 XYZ-001-001    NA Weight  96.8 &lt;NA&gt;     &lt;NA&gt;      &lt;NA&gt;       MAXIMUM</div><div class='input'>
<span class='co'># Sample ADEG dataset with triplicate record for only AVISIT = 'Baseline' ---</span>
<span class='no'>adeg</span> <span class='kw'>&lt;-</span> <span class='kw pkg'>tibble</span><span class='kw ns'>::</span><span class='fu'><a href='https://tibble.tidyverse.org/reference/tribble.html'>tribble</a></span>(
  ~<span class='no'>USUBJID</span>, ~<span class='no'>EGSEQ</span>, ~<span class='no'>PARAM</span>,             ~<span class='no'>AVISIT</span>,    ~<span class='no'>EGDTC</span>,            ~<span class='no'>AVAL</span>, ~<span class='no'>TRTA</span>,
  <span class='st'>"XYZ-1001"</span>,    <span class='fl'>1</span>, <span class='st'>"QTcF Int. (msec)"</span>, <span class='st'>"Baseline"</span>, <span class='st'>"2016-02-24T07:50"</span>,  <span class='fl'>385</span>, <span class='st'>""</span>,
  <span class='st'>"XYZ-1001"</span>,    <span class='fl'>2</span>, <span class='st'>"QTcF Int. (msec)"</span>, <span class='st'>"Baseline"</span>, <span class='st'>"2016-02-24T07:52"</span>,  <span class='fl'>399</span>, <span class='st'>""</span>,
  <span class='st'>"XYZ-1001"</span>,    <span class='fl'>3</span>, <span class='st'>"QTcF Int. (msec)"</span>, <span class='st'>"Baseline"</span>, <span class='st'>"2016-02-24T07:56"</span>,  <span class='fl'>396</span>, <span class='st'>""</span>,
  <span class='st'>"XYZ-1001"</span>,    <span class='fl'>4</span>, <span class='st'>"QTcF Int. (msec)"</span>, <span class='st'>"Visit 2"</span>,  <span class='st'>"2016-03-08T09:48"</span>,  <span class='fl'>393</span>, <span class='st'>"Placebo"</span>,
  <span class='st'>"XYZ-1001"</span>,    <span class='fl'>5</span>, <span class='st'>"QTcF Int. (msec)"</span>, <span class='st'>"Visit 2"</span>,  <span class='st'>"2016-03-08T09:51"</span>,  <span class='fl'>388</span>, <span class='st'>"Placebo"</span>,
  <span class='st'>"XYZ-1001"</span>,    <span class='fl'>6</span>, <span class='st'>"QTcF Int. (msec)"</span>, <span class='st'>"Visit 3"</span>,  <span class='st'>"2016-03-22T10:48"</span>,  <span class='fl'>394</span>, <span class='st'>"Placebo"</span>,
  <span class='st'>"XYZ-1001"</span>,    <span class='fl'>7</span>, <span class='st'>"QTcF Int. (msec)"</span>, <span class='st'>"Visit 3"</span>,  <span class='st'>"2016-03-22T10:51"</span>,  <span class='fl'>402</span>, <span class='st'>"Placebo"</span>,
  <span class='st'>"XYZ-1002"</span>,    <span class='fl'>1</span>, <span class='st'>"QTcF Int. (msec)"</span>, <span class='st'>"Baseline"</span>, <span class='st'>"2016-02-22T07:58"</span>,  <span class='fl'>399</span>, <span class='st'>""</span>,
  <span class='st'>"XYZ-1002"</span>,    <span class='fl'>2</span>, <span class='st'>"QTcF Int. (msec)"</span>, <span class='st'>"Baseline"</span>, <span class='st'>"2016-02-22T07:58"</span>,  <span class='fl'>410</span>, <span class='st'>""</span>,
  <span class='st'>"XYZ-1002"</span>,    <span class='fl'>3</span>, <span class='st'>"QTcF Int. (msec)"</span>, <span class='st'>"Baseline"</span>, <span class='st'>"2016-02-22T08:01"</span>,  <span class='fl'>392</span>, <span class='st'>""</span>,
  <span class='st'>"XYZ-1002"</span>,    <span class='fl'>4</span>, <span class='st'>"QTcF Int. (msec)"</span>, <span class='st'>"Visit 2"</span>,  <span class='st'>"2016-03-06T09:53"</span>,  <span class='fl'>407</span>, <span class='st'>"Active 20mg"</span>,
  <span class='st'>"XYZ-1002"</span>,    <span class='fl'>5</span>, <span class='st'>"QTcF Int. (msec)"</span>, <span class='st'>"Visit 2"</span>,  <span class='st'>"2016-03-06T09:56"</span>,  <span class='fl'>400</span>, <span class='st'>"Active 20mg"</span>,
  <span class='st'>"XYZ-1002"</span>,    <span class='fl'>6</span>, <span class='st'>"QTcF Int. (msec)"</span>, <span class='st'>"Visit 3"</span>,  <span class='st'>"2016-03-24T10:53"</span>,  <span class='fl'>414</span>, <span class='st'>"Active 20mg"</span>,
  <span class='st'>"XYZ-1002"</span>,    <span class='fl'>7</span>, <span class='st'>"QTcF Int. (msec)"</span>, <span class='st'>"Visit 3"</span>,  <span class='st'>"2016-03-24T10:56"</span>,  <span class='fl'>402</span>, <span class='st'>"Active 20mg"</span>,
)

<span class='co'># Summarize the average of AVAL for AVISIT records greater than 2</span>
<span class='fu'>derive_summary_records</span>(
  <span class='no'>adeg</span>,
  <span class='kw'>by_vars</span> <span class='kw'>=</span> <span class='fu'><a href='https://dplyr.tidyverse.org/reference/vars.html'>vars</a></span>(<span class='no'>USUBJID</span>, <span class='no'>PARAM</span>, <span class='no'>AVISIT</span>),
  <span class='kw'>fns</span> <span class='kw'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/list.html'>list</a></span>(<span class='no'>AVAL</span> ~ <span class='fu'><a href='https://rdrr.io/r/base/mean.html'>mean</a></span>(<span class='no'>.</span>, <span class='kw'>na.rm</span> <span class='kw'>=</span> <span class='fl'>TRUE</span>)),
  <span class='kw'>filter_rows</span> <span class='kw'>=</span> <span class='kw pkg'>dplyr</span><span class='kw ns'>::</span><span class='fu'><a href='https://dplyr.tidyverse.org/reference/n.html'>n</a></span>() <span class='kw'>&gt;</span> <span class='fl'>2</span>,
  <span class='kw'>set_values_to</span> <span class='kw'>=</span> <span class='fu'><a href='https://dplyr.tidyverse.org/reference/vars.html'>vars</a></span>(<span class='kw'>DTYPE</span> <span class='kw'>=</span> <span class='st'>"AVERAGE"</span>)
)</div><div class='output co'>#&gt; # A tibble: 16 x 8
#&gt;    USUBJID  EGSEQ PARAM          AVISIT   EGDTC          AVAL TRTA        DTYPE 
#&gt;    &lt;chr&gt;    &lt;dbl&gt; &lt;chr&gt;          &lt;chr&gt;    &lt;chr&gt;         &lt;dbl&gt; &lt;chr&gt;       &lt;chr&gt; 
#&gt;  1 XYZ-1001     1 QTcF Int. (ms… Baseline 2016-02-24T0…  385  ""          &lt;NA&gt;  
#&gt;  2 XYZ-1001     2 QTcF Int. (ms… Baseline 2016-02-24T0…  399  ""          &lt;NA&gt;  
#&gt;  3 XYZ-1001     3 QTcF Int. (ms… Baseline 2016-02-24T0…  396  ""          &lt;NA&gt;  
#&gt;  4 XYZ-1001    NA QTcF Int. (ms… Baseline &lt;NA&gt;           393. ""          AVERA…
#&gt;  5 XYZ-1001     4 QTcF Int. (ms… Visit 2  2016-03-08T0…  393  "Placebo"   &lt;NA&gt;  
#&gt;  6 XYZ-1001     5 QTcF Int. (ms… Visit 2  2016-03-08T0…  388  "Placebo"   &lt;NA&gt;  
#&gt;  7 XYZ-1001     6 QTcF Int. (ms… Visit 3  2016-03-22T1…  394  "Placebo"   &lt;NA&gt;  
#&gt;  8 XYZ-1001     7 QTcF Int. (ms… Visit 3  2016-03-22T1…  402  "Placebo"   &lt;NA&gt;  
#&gt;  9 XYZ-1002     1 QTcF Int. (ms… Baseline 2016-02-22T0…  399  ""          &lt;NA&gt;  
#&gt; 10 XYZ-1002     2 QTcF Int. (ms… Baseline 2016-02-22T0…  410  ""          &lt;NA&gt;  
#&gt; 11 XYZ-1002     3 QTcF Int. (ms… Baseline 2016-02-22T0…  392  ""          &lt;NA&gt;  
#&gt; 12 XYZ-1002    NA QTcF Int. (ms… Baseline &lt;NA&gt;           400. ""          AVERA…
#&gt; 13 XYZ-1002     4 QTcF Int. (ms… Visit 2  2016-03-06T0…  407  "Active 20… &lt;NA&gt;  
#&gt; 14 XYZ-1002     5 QTcF Int. (ms… Visit 2  2016-03-06T0…  400  "Active 20… &lt;NA&gt;  
#&gt; 15 XYZ-1002     6 QTcF Int. (ms… Visit 3  2016-03-24T1…  414  "Active 20… &lt;NA&gt;  
#&gt; 16 XYZ-1002     7 QTcF Int. (ms… Visit 3  2016-03-24T1…  402  "Active 20… &lt;NA&gt;  </div></pre>
  </div>
  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">
    <nav id="toc" data-toggle="toc" class="sticky-top">
      <h2 data-toc-skip>Contents</h2>
    </nav>
  </div>
</div>


      <footer>
      <div class="copyright">
  <p>Developed by Thomas Neitmann, Alice Ehmann, Stefan Bundfuss, Samia Kabi, Vignesh Thanikachalam, Ondrej Slama, Shimeng Huang.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.5.0.</p>
</div>

      </footer>
   </div>

  


  </body>
</html>


