<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Creating an Exposure (BDS) ADaM • admiral</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png">
<link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png">
<link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png">
<link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png">
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.4.0/flatly/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><!-- docsearch --><script src="../docsearch.js"></script><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/docsearch.js/2.6.3/docsearch.min.css" integrity="sha256-QOSRU/ra9ActyXkIBbiIB144aDBdtvXBcNc3OTNuX/Q=" crossorigin="anonymous">
<link href="../docsearch.css" rel="stylesheet">
<script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/jquery.mark.min.js" integrity="sha256-4HLtjeVgH0eIB3aZ9mLYF6E8oU5chNdjU6p6rrXpl9U=" crossorigin="anonymous"></script><meta property="og:title" content="Creating an Exposure (BDS) ADaM">
<meta property="og:description" content="admiral">
<meta property="og:image" content="/logo.png">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">admiral</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">0.3.0</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">
    <span class="fas fa fas fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../articles/admiral.html">Get started</a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li class="divider">
    <li class="dropdown-header">User Guides</li>
    <li>
      <a href="../articles/adsl.html">Creating ADSL</a>
    </li>
    <li>
      <a href="../articles/occds.html">Creating an OCCDS ADaM</a>
    </li>
    <li>
      <a href="../articles/bds_finding.html">Creating a BDS Finding ADaM</a>
    </li>
    <li>
      <a href="../articles/bds_exposure.html">Creating an Exposure (BDS) ADaM</a>
    </li>
    <li>
      <a href="../articles/imputation.html">Date and Time Imputation</a>
    </li>
    <li>
      <a href="../articles/faq.html">FAQ</a>
    </li>
    <li class="divider">
    <li class="dropdown-header">Developer Guides</li>
    <li>
      <a href="../articles/programming_strategy.html">Programming Strategy</a>
    </li>
    <li>
      <a href="../articles/git_usage.html">Guidance for git Usage</a>
    </li>
  </ul>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/Roche-GSK/admiral/">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
<form class="navbar-form navbar-right hidden-xs hidden-sm" role="search">
        <div class="form-group">
          <input type="search" class="form-control" name="search-input" id="search-input" placeholder="Search..." aria-label="Search for..." autocomplete="off">
</div>
      </form>
      
    </div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Creating an Exposure (BDS) ADaM</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/Roche-GSK/admiral/blob/master/vignettes/bds_exposure.Rmd"><code>vignettes/bds_exposure.Rmd</code></a></small>
      <div class="hidden name"><code>bds_exposure.Rmd</code></div>

    </div>

    
    
<div id="introduction" class="section level2">
<h2 class="hasAnchor">
<a href="#introduction" class="anchor"></a>Introduction</h2>
<p>This article describes creating an Exposure ADaM using the BDS structure. Examples are currently presented using an underlying EX domain where the EX domain represents data as collected on the CRF and the ADEX ADaM is output. However, the examples can be applied to situations where an EC domain is used as input and/or ADEC or another exposure ADaM is created.</p>
<p>There are many different approaches to modeling exposure data. This vignette gives examples of creating <code>PARAMCD</code> and <code>AVAL</code> combinations using exposure data. This vignette is not meant to be a guide or standard for the structure of exposure analysis datasets.</p>
<p><strong>Note</strong>: <em>All examples assume CDISC SDTM and/or ADaM format as input unless otherwise specified.</em></p>
</div>
<div id="programming-workflow" class="section level2">
<h2 class="hasAnchor">
<a href="#programming-workflow" class="anchor"></a>Programming Workflow</h2>
<ul>
<li><a href="#readdata">Read in Data</a></li>
<li><a href="#datetime">Derive/Impute Numeric Date/Time and Analysis Day (<code>ADT</code>, <code>ADTM</code>, <code>ADY</code>, <code>ADTF</code>, <code>ATMF</code>)</a></li>
<li><a href="#duration">Compute Duration for a Record</a></li>
<li><a href="#onetoone">Create 1:1 Mapping Records</a></li>
<li><a href="#summaryrec">Create Summary Records</a></li>
<li><a href="#paramcd">Assign <code>PARAMCD</code>, <code>PARAMN</code>, etc. from Reference Tables</a></li>
<li><a href="#aseq">Assign <code>ASEQ</code></a></li>
<li><a href="#cat">Derive Categorization Variables (<code>AVALCATx</code>)</a></li>
<li><a href="#example">Example Scripts</a></li>
</ul>
<div id="readdata" class="section level3">
<h3 class="hasAnchor">
<a href="#readdata" class="anchor"></a>Read in Data</h3>
<p>To start, all data frames needed for the creation of ADEX should be read into the environment. This will be a company specific process. Some of the data frames needed may be <code>ex</code>, <code>suppex</code>, and <code>adsl</code>.</p>
<p>For example purpose, the CDISC Pilot SDTM and ADaM datasets—which are included in <code>{admiral}</code>—are used.</p>
<div class="sourceCode" id="cb1"><html><body><pre class="r"><span class="fu"><a href="https://rdrr.io/r/base/library.html">library</a></span>(<span class="no">dplyr</span>)
<span class="fu"><a href="https://rdrr.io/r/base/library.html">library</a></span>(<span class="no">lubridate</span>)
<span class="fu"><a href="https://rdrr.io/r/base/library.html">library</a></span>(<span class="no">stringr</span>)
<span class="fu"><a href="https://rdrr.io/r/base/library.html">library</a></span>(<span class="no">tibble</span>)
<span class="fu"><a href="https://rdrr.io/r/base/library.html">library</a></span>(<span class="no">admiral</span>)

<span class="fu"><a href="https://rdrr.io/r/utils/data.html">data</a></span>(<span class="st">"adsl"</span>)
<span class="fu"><a href="https://rdrr.io/r/utils/data.html">data</a></span>(<span class="st">"ex"</span>)</pre></body></html></div>
<p>The <code>suppex</code> domain can be joined to the <code>ex</code> domain using the function <code><a href="../reference/derive_vars_suppqual.html">derive_vars_suppqual()</a></code>.</p>
<p>This function will transpose the supplemental SDTM domain (e.g. <code>suppex</code>) and join the transposed data to the parent domain (e.g. <code>ex</code>) by <code>STUDYID</code>, <code>USUBJID</code> using the <code>IDVAR</code> and <code>IDVARVAL</code> as an additional join variable.</p>
<p>Example call:</p>
<div class="sourceCode" id="cb2"><html><body><pre class="r"><span class="no">ex</span> <span class="kw">&lt;-</span> <span class="fu"><a href="../reference/derive_vars_suppqual.html">derive_vars_suppqual</a></span>(<span class="no">ex</span>, <span class="no">suppex</span>)</pre></body></html></div>
<p>Please note, the CDISC pilot did not include a <code>suppex</code> dataset and therefore this join is not demonstrated.</p>
<p>At this step, it may be useful to join <code>adsl</code> to your <code>ex</code> domain as well:</p>
<div class="sourceCode" id="cb3"><html><body><pre class="r"><span class="no">adex</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/join.html">left_join</a></span>(
  <span class="no">ex</span>,
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span>(<span class="no">adsl</span>, <span class="no">STUDYID</span>, <span class="no">USUBJID</span>, <span class="fu"><a href="https://dplyr.tidyverse.org/reference/reexports.html">starts_with</a></span>(<span class="st">"TRT"</span>)),
  <span class="kw">by</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"STUDYID"</span>, <span class="st">"USUBJID"</span>)
)

<span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span>(<span class="no">adex</span>)
<span class="co">#&gt; # A tibble: 6 x 24</span>
<span class="co">#&gt;   STUDYID DOMAIN USUBJID EXSEQ EXTRT EXDOSE EXDOSU EXDOSFRM EXDOSFRQ EXROUTE</span>
<span class="co">#&gt;   &lt;chr&gt;   &lt;chr&gt;  &lt;chr&gt;   &lt;dbl&gt; &lt;chr&gt;  &lt;dbl&gt; &lt;chr&gt;  &lt;chr&gt;    &lt;chr&gt;    &lt;chr&gt;  </span>
<span class="co">#&gt; 1 CDISCP… EX     01-701…     1 PLAC…      0 mg     PATCH    QD       TRANSD…</span>
<span class="co">#&gt; 2 CDISCP… EX     01-701…     2 PLAC…      0 mg     PATCH    QD       TRANSD…</span>
<span class="co">#&gt; 3 CDISCP… EX     01-701…     3 PLAC…      0 mg     PATCH    QD       TRANSD…</span>
<span class="co">#&gt; 4 CDISCP… EX     01-701…     1 PLAC…      0 mg     PATCH    QD       TRANSD…</span>
<span class="co">#&gt; 5 CDISCP… EX     01-701…     2 PLAC…      0 mg     PATCH    QD       TRANSD…</span>
<span class="co">#&gt; 6 CDISCP… EX     01-701…     1 XANO…     54 mg     PATCH    QD       TRANSD…</span>
<span class="co">#&gt; # … with 14 more variables: VISITNUM &lt;dbl&gt;, VISIT &lt;chr&gt;, VISITDY &lt;dbl&gt;,</span>
<span class="co">#&gt; #   EXSTDTC &lt;chr&gt;, EXENDTC &lt;chr&gt;, EXSTDY &lt;dbl&gt;, EXENDY &lt;dbl&gt;, TRT01P &lt;chr&gt;,</span>
<span class="co">#&gt; #   TRT01A &lt;chr&gt;, TRTSDTM &lt;dttm&gt;, TRTSDT &lt;date&gt;, TRTEDTM &lt;dttm&gt;, TRTEDT &lt;date&gt;,</span>
<span class="co">#&gt; #   TRTDURD &lt;dbl&gt;</span></pre></body></html></div>
<p>The CDISC pilot <code>ex</code> domain data does not contain a dose adjustment flag or the planned dose information. For demonstration purposes, this will be added to the data.</p>
<div class="sourceCode" id="cb4"><html><body><pre class="r"><span class="no">adex</span> <span class="kw">&lt;-</span> <span class="no">adex</span> <span class="kw">%&gt;%</span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span>(
    <span class="kw">EXADJ</span> <span class="kw">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/case_when.html">case_when</a></span>(
      <span class="no">USUBJID</span> <span class="kw">==</span> <span class="st">"01-701-1034"</span> <span class="kw">&amp;</span> <span class="no">VISIT</span> <span class="kw">%in%</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"WEEK 2"</span>, <span class="st">"WEEK 24"</span>) ~ <span class="st">"ADVERSE EVENT"</span>,
      <span class="no">USUBJID</span> <span class="kw">==</span> <span class="st">"01-701-1148"</span> <span class="kw">&amp;</span> <span class="no">VISIT</span> <span class="kw">%in%</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"WEEK 24"</span>) ~ <span class="st">"MEDICATION ERROR"</span>,
      <span class="fl">TRUE</span> ~ <span class="fl">NA_character_</span>
    ),
    <span class="kw">EXDOSE</span> <span class="kw">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/case_when.html">case_when</a></span>(
      <span class="no">USUBJID</span> <span class="kw">==</span> <span class="st">"01-701-1034"</span> <span class="kw">&amp;</span> <span class="no">VISIT</span> <span class="kw">%in%</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"WEEK 2"</span>, <span class="st">"WEEK 24"</span>) ~ <span class="fl">0</span>,
      <span class="no">USUBJID</span> <span class="kw">==</span> <span class="st">"01-701-1148"</span> <span class="kw">&amp;</span> <span class="no">VISIT</span> <span class="kw">%in%</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"WEEK 24"</span>) ~ <span class="fl">0</span>,
      <span class="fl">TRUE</span> ~ <span class="no">EXDOSE</span>
    )
  ) <span class="kw">%&gt;%</span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span>(<span class="kw">EXPLDOS</span> <span class="kw">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/if_else.html">if_else</a></span>(<span class="no">EXTRT</span> <span class="kw">==</span> <span class="st">"PLACEBO"</span>, <span class="fl">0</span>, <span class="fl">54</span>))

<span class="fu"><a href="https://dplyr.tidyverse.org/reference/distinct.html">distinct</a></span>(<span class="no">adex</span>, <span class="no">EXTRT</span>, <span class="no">EXPLDOS</span>)
<span class="co">#&gt; # A tibble: 2 x 2</span>
<span class="co">#&gt;   EXTRT      EXPLDOS</span>
<span class="co">#&gt;   &lt;chr&gt;        &lt;dbl&gt;</span>
<span class="co">#&gt; 1 PLACEBO          0</span>
<span class="co">#&gt; 2 XANOMELINE      54</span>
<span class="fu"><a href="https://dplyr.tidyverse.org/reference/tally.html">count</a></span>(<span class="no">adex</span>, <span class="no">EXADJ</span>)
<span class="co">#&gt; # A tibble: 3 x 2</span>
<span class="co">#&gt;   EXADJ                n</span>
<span class="co">#&gt;   &lt;chr&gt;            &lt;int&gt;</span>
<span class="co">#&gt; 1 ADVERSE EVENT        2</span>
<span class="co">#&gt; 2 MEDICATION ERROR     1</span>
<span class="co">#&gt; 3 &lt;NA&gt;               588</span></pre></body></html></div>
</div>
<div id="datetime" class="section level3">
<h3 class="hasAnchor">
<a href="#datetime" class="anchor"></a>Derive/Impute Numeric Date/Time and Analysis Day (<code>ADT</code>, <code>ADTM</code>, <code>ADY</code>, <code>ADTF</code>, <code>ATMF</code>)</h3>
<p>The function <code><a href="../reference/derive_vars_dt.html">derive_vars_dt()</a></code> can be used to derive <code>ADT</code>. This function allows the user to impute the date as well.</p>
<p>Example calls:</p>
<div class="sourceCode" id="cb5"><html><body><pre class="r"><span class="no">adex</span> <span class="kw">&lt;-</span> <span class="fu"><a href="../reference/derive_vars_dt.html">derive_vars_dt</a></span>(<span class="no">adex</span>, <span class="kw">new_vars_prefix</span> <span class="kw">=</span> <span class="st">"AST"</span>, <span class="kw">dtc</span> <span class="kw">=</span> <span class="no">EXSTDTC</span>)
<span class="no">adex</span> <span class="kw">&lt;-</span> <span class="fu"><a href="../reference/derive_vars_dt.html">derive_vars_dt</a></span>(<span class="no">adex</span>, <span class="kw">new_vars_prefix</span> <span class="kw">=</span> <span class="st">"AEN"</span>, <span class="kw">dtc</span> <span class="kw">=</span> <span class="no">EXENDTC</span>)

<span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span>(<span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span>(<span class="no">adex</span>, <span class="no">EXSTDTC</span>, <span class="no">EXENDTC</span>, <span class="no">ASTDT</span>, <span class="no">AENDT</span>))
<span class="co">#&gt; # A tibble: 6 x 4</span>
<span class="co">#&gt;   EXSTDTC    EXENDTC    ASTDT      AENDT     </span>
<span class="co">#&gt;   &lt;chr&gt;      &lt;chr&gt;      &lt;date&gt;     &lt;date&gt;    </span>
<span class="co">#&gt; 1 2014-01-02 2014-01-16 2014-01-02 2014-01-16</span>
<span class="co">#&gt; 2 2014-01-17 2014-06-18 2014-01-17 2014-06-18</span>
<span class="co">#&gt; 3 2014-06-19 2014-07-02 2014-06-19 2014-07-02</span>
<span class="co">#&gt; 4 2012-08-05 2012-08-27 2012-08-05 2012-08-27</span>
<span class="co">#&gt; 5 2012-08-28 2012-09-01 2012-08-28 2012-09-01</span>
<span class="co">#&gt; 6 2013-07-19 2013-08-01 2013-07-19 2013-08-01</span></pre></body></html></div>
<div class="sourceCode" id="cb6"><html><body><pre class="r"><span class="no">adex</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span>(<span class="no">adex</span>, -<span class="no">ASTDTF</span>, -<span class="no">AENDTF</span>)</pre></body></html></div>
<p>This next examples demonstrates the datetime imputation features available in the <code>derive_vars_dtm</code> function where the time is imputed as “00:00:00”:</p>
<div class="sourceCode" id="cb7"><html><body><pre class="r"><span class="no">adex</span> <span class="kw">&lt;-</span> <span class="fu"><a href="../reference/derive_vars_dtm.html">derive_vars_dtm</a></span>(
  <span class="no">adex</span>,
  <span class="kw">dtc</span> <span class="kw">=</span> <span class="no">EXSTDTC</span>,
  <span class="kw">date_imputation</span> <span class="kw">=</span> <span class="st">"first"</span>,
  <span class="kw">new_vars_prefix</span> <span class="kw">=</span> <span class="st">"AST"</span>
)

<span class="no">adex</span> <span class="kw">&lt;-</span> <span class="fu"><a href="../reference/derive_vars_dtm.html">derive_vars_dtm</a></span>(
  <span class="no">adex</span>,
  <span class="kw">dtc</span> <span class="kw">=</span> <span class="no">EXENDTC</span>,
  <span class="kw">date_imputation</span> <span class="kw">=</span> <span class="st">"last"</span>,
  <span class="kw">new_vars_prefix</span> <span class="kw">=</span> <span class="st">"AEN"</span>
)

<span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span>(<span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span>(<span class="no">adex</span>, <span class="no">EXSTDTC</span>, <span class="no">EXENDTC</span>, <span class="no">ASTDT</span>, <span class="no">ASTDTM</span>, <span class="no">AENDT</span>, <span class="no">AENDTM</span>))
<span class="co">#&gt; # A tibble: 6 x 6</span>
<span class="co">#&gt;   EXSTDTC  EXENDTC ASTDT      ASTDTM              AENDT      AENDTM             </span>
<span class="co">#&gt;   &lt;chr&gt;    &lt;chr&gt;   &lt;date&gt;     &lt;dttm&gt;              &lt;date&gt;     &lt;dttm&gt;             </span>
<span class="co">#&gt; 1 2014-01… 2014-0… 2014-01-02 2014-01-02 00:00:00 2014-01-16 2014-01-16 00:00:00</span>
<span class="co">#&gt; 2 2014-01… 2014-0… 2014-01-17 2014-01-17 00:00:00 2014-06-18 2014-06-18 00:00:00</span>
<span class="co">#&gt; 3 2014-06… 2014-0… 2014-06-19 2014-06-19 00:00:00 2014-07-02 2014-07-02 00:00:00</span>
<span class="co">#&gt; 4 2012-08… 2012-0… 2012-08-05 2012-08-05 00:00:00 2012-08-27 2012-08-27 00:00:00</span>
<span class="co">#&gt; 5 2012-08… 2012-0… 2012-08-28 2012-08-28 00:00:00 2012-09-01 2012-09-01 00:00:00</span>
<span class="co">#&gt; 6 2013-07… 2013-0… 2013-07-19 2013-07-19 00:00:00 2013-08-01 2013-08-01 00:00:00</span></pre></body></html></div>
<p>The example above imputes the start date to the first first day of the month and imputes the end date to the last day of the month.</p>
<p>Please see the <a href="imputation.Rmd">Date and Time Imputation</a> for additional examples on calculating and imputing analysis dates.</p>
<p>Next, the analysis study days can be derived:</p>
<div class="sourceCode" id="cb8"><html><body><pre class="r"><span class="no">adex</span> <span class="kw">&lt;-</span> <span class="fu"><a href="../reference/derive_var_astdy.html">derive_var_astdy</a></span>(<span class="no">adex</span>, <span class="kw">reference_date</span> <span class="kw">=</span> <span class="no">TRTSDT</span>, <span class="kw">date</span> <span class="kw">=</span> <span class="no">ASTDT</span>)
<span class="no">adex</span> <span class="kw">&lt;-</span> <span class="fu"><a href="../reference/derive_var_aendy.html">derive_var_aendy</a></span>(<span class="no">adex</span>, <span class="kw">reference_date</span> <span class="kw">=</span> <span class="no">TRTSDT</span>, <span class="kw">date</span> <span class="kw">=</span> <span class="no">AENDT</span>)

<span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span>(<span class="fu"><a href="https://dplyr.tidyverse.org/reference/distinct.html">distinct</a></span>(<span class="no">adex</span>, <span class="no">EXSTDTC</span>, <span class="no">EXENDTC</span>, <span class="no">ASTDT</span>, <span class="no">ASTDY</span>, <span class="no">AENDT</span>, <span class="no">AENDY</span>, <span class="no">TRTSDT</span>))
<span class="co">#&gt; # A tibble: 6 x 7</span>
<span class="co">#&gt;   EXSTDTC    EXENDTC    ASTDT      ASTDY AENDT      AENDY TRTSDT    </span>
<span class="co">#&gt;   &lt;chr&gt;      &lt;chr&gt;      &lt;date&gt;     &lt;dbl&gt; &lt;date&gt;     &lt;dbl&gt; &lt;date&gt;    </span>
<span class="co">#&gt; 1 2014-01-02 2014-01-16 2014-01-02     1 2014-01-16    15 2014-01-02</span>
<span class="co">#&gt; 2 2014-01-17 2014-06-18 2014-01-17    16 2014-06-18   168 2014-01-02</span>
<span class="co">#&gt; 3 2014-06-19 2014-07-02 2014-06-19   169 2014-07-02   182 2014-01-02</span>
<span class="co">#&gt; 4 2012-08-05 2012-08-27 2012-08-05     1 2012-08-27    23 2012-08-05</span>
<span class="co">#&gt; 5 2012-08-28 2012-09-01 2012-08-28    24 2012-09-01    28 2012-08-05</span>
<span class="co">#&gt; 6 2013-07-19 2013-08-01 2013-07-19     1 2013-08-01    14 2013-07-19</span></pre></body></html></div>
</div>
<div id="duration" class="section level3">
<h3 class="hasAnchor">
<a href="#duration" class="anchor"></a>Compute duration for a record</h3>
<p>To compute the duration of treatment or exposure for a record, the <code><a href="../reference/derive_vars_duration.html">derive_vars_duration()</a></code> function can be used.</p>
<div class="sourceCode" id="cb9"><html><body><pre class="r"><span class="no">adex</span> <span class="kw">&lt;-</span> <span class="no">adex</span> <span class="kw">%&gt;%</span>
  <span class="fu"><a href="../reference/derive_vars_duration.html">derive_vars_duration</a></span>(
    <span class="kw">new_var</span> <span class="kw">=</span> <span class="no">EXDURD</span>,
    <span class="kw">start_date</span> <span class="kw">=</span> <span class="no">ASTDT</span>,
    <span class="kw">end_date</span> <span class="kw">=</span> <span class="no">AENDT</span>
  )

<span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span>(<span class="fu"><a href="https://dplyr.tidyverse.org/reference/distinct.html">distinct</a></span>(<span class="no">adex</span>, <span class="no">ASTDT</span>, <span class="no">AENDT</span>, <span class="no">EXDURD</span>))
<span class="co">#&gt; # A tibble: 6 x 3</span>
<span class="co">#&gt;   ASTDT      AENDT      EXDURD</span>
<span class="co">#&gt;   &lt;date&gt;     &lt;date&gt;      &lt;dbl&gt;</span>
<span class="co">#&gt; 1 2014-01-02 2014-01-16     15</span>
<span class="co">#&gt; 2 2014-01-17 2014-06-18    153</span>
<span class="co">#&gt; 3 2014-06-19 2014-07-02     14</span>
<span class="co">#&gt; 4 2012-08-05 2012-08-27     23</span>
<span class="co">#&gt; 5 2012-08-28 2012-09-01      5</span>
<span class="co">#&gt; 6 2013-07-19 2013-08-01     14</span></pre></body></html></div>
<p>The units of the calculated duration can also be changed. In this example, the duration is output as years:</p>
<div class="sourceCode" id="cb10"><html><body><pre class="r"><span class="no">adex</span> <span class="kw">&lt;-</span> <span class="no">adex</span> <span class="kw">%&gt;%</span>
  <span class="fu"><a href="../reference/derive_vars_duration.html">derive_vars_duration</a></span>(
    <span class="kw">new_var</span> <span class="kw">=</span> <span class="no">EXDURDY</span>,
    <span class="kw">out_unit</span> <span class="kw">=</span> <span class="st">"years"</span>,
    <span class="kw">start_date</span> <span class="kw">=</span> <span class="no">ASTDT</span>,
    <span class="kw">end_date</span> <span class="kw">=</span> <span class="no">AENDT</span>
  )

<span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span>(<span class="fu"><a href="https://dplyr.tidyverse.org/reference/distinct.html">distinct</a></span>(<span class="no">adex</span>, <span class="no">ASTDT</span>, <span class="no">AENDT</span>, <span class="no">EXDURD</span>, <span class="no">EXDURDY</span>))
<span class="co">#&gt; # A tibble: 6 x 4</span>
<span class="co">#&gt;   ASTDT      AENDT      EXDURD EXDURDY</span>
<span class="co">#&gt;   &lt;date&gt;     &lt;date&gt;      &lt;dbl&gt;   &lt;dbl&gt;</span>
<span class="co">#&gt; 1 2014-01-02 2014-01-16     15  0.0411</span>
<span class="co">#&gt; 2 2014-01-17 2014-06-18    153  0.419 </span>
<span class="co">#&gt; 3 2014-06-19 2014-07-02     14  0.0384</span>
<span class="co">#&gt; 4 2012-08-05 2012-08-27     23  0.0630</span>
<span class="co">#&gt; 5 2012-08-28 2012-09-01      5  0.0137</span>
<span class="co">#&gt; 6 2013-07-19 2013-08-01     14  0.0384</span></pre></body></html></div>
<p>Please refer to the <code><a href="../reference/derive_vars_duration.html">derive_vars_duration()</a></code> documentation for detailed information on the input parameters.</p>
<p>It may be necessary to calculate additional intermediate values. For example, the cumulative doses received and cumulative planned doses may be calculated as:</p>
<div class="sourceCode" id="cb11"><html><body><pre class="r"><span class="no">adex</span> <span class="kw">&lt;-</span> <span class="no">adex</span> <span class="kw">%&gt;%</span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span>(
    <span class="kw">DOSEO</span> <span class="kw">=</span> <span class="no">EXDOSE</span> * <span class="no">EXDURD</span>,
    <span class="kw">PDOSEO</span> <span class="kw">=</span> <span class="no">EXPLDOS</span> * <span class="no">EXDURD</span>
  )

<span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span>(<span class="fu"><a href="https://dplyr.tidyverse.org/reference/distinct.html">distinct</a></span>(<span class="no">adex</span>, <span class="no">EXDOSE</span>, <span class="no">EXPLDOS</span>, <span class="no">EXDURD</span>, <span class="no">DOSEO</span>, <span class="no">PDOSEO</span>))
<span class="co">#&gt; # A tibble: 6 x 5</span>
<span class="co">#&gt;   EXDOSE EXPLDOS EXDURD DOSEO PDOSEO</span>
<span class="co">#&gt;    &lt;dbl&gt;   &lt;dbl&gt;  &lt;dbl&gt; &lt;dbl&gt;  &lt;dbl&gt;</span>
<span class="co">#&gt; 1      0       0     15     0      0</span>
<span class="co">#&gt; 2      0       0    153     0      0</span>
<span class="co">#&gt; 3      0       0     14     0      0</span>
<span class="co">#&gt; 4      0       0     23     0      0</span>
<span class="co">#&gt; 5      0       0      5     0      0</span>
<span class="co">#&gt; 6     54      54     14   756    756</span></pre></body></html></div>
</div>
<div id="onetoone" class="section level3">
<h3 class="hasAnchor">
<a href="#onetoone" class="anchor"></a>Create 1:1 mapping records</h3>
<p>The first set of exposure records to create will be records mapped 1:1 to an existing collected exposure record in SDTM. For these records, the <code>AVAL</code> or <code>AVALC</code> would be calculated using columns that exist on the data and no summarising of records would be necessary.</p>
<p>These records may be used for input into summary records or be used individually for summarization in outputs. Some examples may be exposure duration, dose administered, dose adjusted, etc. based on one exposure record in SDTM.</p>
<p>These records can be derived using simple <code><a href="https://dplyr.tidyverse.org/reference/mutate.html">dplyr::mutate</a></code> assignments and then combined:</p>
<div class="sourceCode" id="cb12"><html><body><pre class="r"><span class="no">adex_durd</span> <span class="kw">&lt;-</span> <span class="no">adex</span> <span class="kw">%&gt;%</span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span>(
    <span class="kw">PARAMCD</span> <span class="kw">=</span> <span class="st">"DURD"</span>,
    <span class="kw">AVAL</span> <span class="kw">=</span> <span class="no">EXDURD</span>
  )

<span class="no">adex_dose</span> <span class="kw">&lt;-</span> <span class="no">adex</span> <span class="kw">%&gt;%</span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span>(
    <span class="kw">PARAMCD</span> <span class="kw">=</span> <span class="st">"DOSE"</span>,
    <span class="kw">AVAL</span> <span class="kw">=</span> <span class="no">DOSEO</span>
  )

<span class="no">adex_pldos</span> <span class="kw">&lt;-</span> <span class="no">adex</span> <span class="kw">%&gt;%</span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span>(
    <span class="kw">PARAMCD</span> <span class="kw">=</span> <span class="st">"PLDOSE"</span>,
    <span class="kw">AVAL</span> <span class="kw">=</span> <span class="no">PDOSEO</span>
  )

<span class="no">adex_adj</span> <span class="kw">&lt;-</span> <span class="no">adex</span> <span class="kw">%&gt;%</span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span>(
    <span class="kw">PARAMCD</span> <span class="kw">=</span> <span class="st">"ADJ"</span>,
    <span class="kw">AVALC</span> <span class="kw">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/if_else.html">if_else</a></span>(!<span class="fu"><a href="https://rdrr.io/r/base/NA.html">is.na</a></span>(<span class="no">EXADJ</span>), <span class="st">"Y"</span>, <span class="fl">NA_character_</span>)
  )

<span class="no">adex_adjae</span> <span class="kw">&lt;-</span> <span class="no">adex</span> <span class="kw">%&gt;%</span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span>(
    <span class="kw">PARAMCD</span> <span class="kw">=</span> <span class="st">"ADJAE"</span>,
    <span class="kw">AVALC</span> <span class="kw">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/if_else.html">if_else</a></span>(<span class="no">EXADJ</span> <span class="kw">==</span> <span class="st">"ADVERSE EVENT"</span>, <span class="st">"Y"</span>, <span class="fl">NA_character_</span>)
  )

<span class="no">adex</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/bind.html">bind_rows</a></span>(
  <span class="no">adex_durd</span>,
  <span class="no">adex_dose</span>,
  <span class="no">adex_pldos</span>,
  <span class="no">adex_adj</span>,
  <span class="no">adex_adjae</span>
) <span class="kw">%&gt;%</span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span>(<span class="kw">PARCAT1</span> <span class="kw">=</span> <span class="st">"INDIVIDUAL"</span>)

<span class="fu"><a href="https://dplyr.tidyverse.org/reference/tally.html">count</a></span>(<span class="no">adex</span>, <span class="no">PARAMCD</span>)
<span class="co">#&gt; # A tibble: 5 x 2</span>
<span class="co">#&gt;   PARAMCD     n</span>
<span class="co">#&gt;   &lt;chr&gt;   &lt;int&gt;</span>
<span class="co">#&gt; 1 ADJ       591</span>
<span class="co">#&gt; 2 ADJAE     591</span>
<span class="co">#&gt; 3 DOSE      591</span>
<span class="co">#&gt; 4 DURD      591</span>
<span class="co">#&gt; 5 PLDOSE    591</span>
<span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span>(<span class="fu"><a href="https://dplyr.tidyverse.org/reference/distinct.html">distinct</a></span>(<span class="no">adex</span>, <span class="no">PARAMCD</span>, <span class="no">AVAL</span>))
<span class="co">#&gt; # A tibble: 6 x 2</span>
<span class="co">#&gt;   PARAMCD  AVAL</span>
<span class="co">#&gt;   &lt;chr&gt;   &lt;dbl&gt;</span>
<span class="co">#&gt; 1 DURD       15</span>
<span class="co">#&gt; 2 DURD      153</span>
<span class="co">#&gt; 3 DURD       14</span>
<span class="co">#&gt; 4 DURD       23</span>
<span class="co">#&gt; 5 DURD        5</span>
<span class="co">#&gt; 6 DURD      158</span></pre></body></html></div>
</div>
<div id="summaryrec" class="section level3">
<h3 class="hasAnchor">
<a href="#summaryrec" class="anchor"></a>Create Summary Records</h3>
<p>Exposure is commonly analyzed by a timing interval (e.g. <code>APHASE</code>, <code>APERIOD</code>, <code>AVISIT</code>, etc.). For these types of calculations, the <code><a href="../reference/derive_params_exposure.html">derive_params_exposure()</a></code> function may be used. In addition to creating a summarized <code>AVAL</code>, the function will also compute minimum and maximum dates for the record.</p>
<p>For example, to calculate the total dose by subject and treatment,</p>
<div class="sourceCode" id="cb13"><html><body><pre class="r"><span class="no">adex</span> <span class="kw">&lt;-</span> <span class="fu"><a href="../reference/derive_params_exposure.html">derive_params_exposure</a></span>(
  <span class="no">adex</span>,
  <span class="kw">by_vars</span> <span class="kw">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/vars.html">vars</a></span>(<span class="no">STUDYID</span>, <span class="no">USUBJID</span>, <span class="no">TRT01P</span>, <span class="no">TRT01A</span>, <span class="no">TRTSDTM</span>, <span class="no">TRTEDTM</span>, <span class="no">TRTSDT</span>, <span class="no">TRTEDT</span>),
  <span class="kw">input_code</span> <span class="kw">=</span> <span class="st">"DOSE"</span>,
  <span class="kw">analysis_var</span> <span class="kw">=</span> <span class="no">AVAL</span>,
  <span class="kw">set_values_to</span> <span class="kw">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/vars.html">vars</a></span>(<span class="kw">PARAMCD</span> <span class="kw">=</span> <span class="st">"TDOSE"</span>, <span class="kw">PARCAT1</span> <span class="kw">=</span> <span class="st">"OVERALL"</span>),
  <span class="kw">summary_fun</span> <span class="kw">=</span> <span class="kw">function</span>(<span class="no">x</span>) <span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span>(<span class="no">x</span>, <span class="kw">na.rm</span> <span class="kw">=</span> <span class="fl">TRUE</span>)
)

<span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span>(<span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span>(<span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span>(<span class="no">adex</span>, <span class="no">PARAMCD</span> <span class="kw">==</span> <span class="st">"TDOSE"</span>), <span class="no">PARAMCD</span>, <span class="no">PARCAT1</span>, <span class="no">AVAL</span>, <span class="no">ASTDT</span>, <span class="no">AENDT</span>))
<span class="co">#&gt; # A tibble: 6 x 5</span>
<span class="co">#&gt;   PARAMCD PARCAT1  AVAL ASTDT      AENDT     </span>
<span class="co">#&gt;   &lt;chr&gt;   &lt;chr&gt;   &lt;dbl&gt; &lt;date&gt;     &lt;date&gt;    </span>
<span class="co">#&gt; 1 TDOSE   OVERALL     0 2014-01-02 2014-07-02</span>
<span class="co">#&gt; 2 TDOSE   OVERALL     0 2012-08-05 2012-09-01</span>
<span class="co">#&gt; 3 TDOSE   OVERALL 13986 2013-07-19 2014-01-14</span>
<span class="co">#&gt; 4 TDOSE   OVERALL   756 2014-03-18 2014-03-31</span>
<span class="co">#&gt; 5 TDOSE   OVERALL   810 2014-07-01 2014-12-30</span>
<span class="co">#&gt; 6 TDOSE   OVERALL     0 2013-02-12 2013-03-09</span></pre></body></html></div>
<p>A record with <code>PARAMCD == "TDOSE"</code> is created with <code>PARCAT1</code> set to <code>"OVERALL"</code> using the records in <code>ADEX</code> where <code>PARAMCD == "DOSE"</code> by summing <code>AVAL</code>. In addition, the <code>ASTDT</code>, and <code>AENDT</code> are created as the minimum and maximum date/times associated with each <code>by_vars</code> grouping.</p>
<p>Multiple parameters (records) may be created at one time using the <code><a href="../reference/call_derivation.html">call_derivation()</a></code> function:</p>
<div class="sourceCode" id="cb14"><html><body><pre class="r"><span class="no">adex</span> <span class="kw">&lt;-</span> <span class="no">adex</span> <span class="kw">%&gt;%</span>
  <span class="fu"><a href="../reference/call_derivation.html">call_derivation</a></span>(
    <span class="kw">derivation</span> <span class="kw">=</span> <span class="no">derive_params_exposure</span>,
    <span class="kw">variable_params</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span>(
      <span class="fu"><a href="../reference/params.html">params</a></span>(
        <span class="kw">set_values_to</span> <span class="kw">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/vars.html">vars</a></span>(<span class="kw">PARAMCD</span> <span class="kw">=</span> <span class="st">"TDOSE"</span>, <span class="kw">PARCAT1</span> <span class="kw">=</span> <span class="st">"OVERALL"</span>),
        <span class="kw">input_code</span> <span class="kw">=</span> <span class="st">"DOSE"</span>,
        <span class="kw">analysis_var</span> <span class="kw">=</span> <span class="no">AVAL</span>,
        <span class="kw">summary_fun</span> <span class="kw">=</span> <span class="kw">function</span>(<span class="no">x</span>) <span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span>(<span class="no">x</span>, <span class="kw">na.rm</span> <span class="kw">=</span> <span class="fl">TRUE</span>)
      ),
      <span class="fu"><a href="../reference/params.html">params</a></span>(
        <span class="kw">set_values_to</span> <span class="kw">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/vars.html">vars</a></span>(<span class="kw">PARAMCD</span> <span class="kw">=</span> <span class="st">"TPDOSE"</span>, <span class="kw">PARCAT1</span> <span class="kw">=</span> <span class="st">"OVERALL"</span>),
        <span class="kw">input_code</span> <span class="kw">=</span> <span class="st">"PLDOSE"</span>,
        <span class="kw">analysis_var</span> <span class="kw">=</span> <span class="no">AVAL</span>,
        <span class="kw">summary_fun</span> <span class="kw">=</span> <span class="kw">function</span>(<span class="no">x</span>) <span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span>(<span class="no">x</span>, <span class="kw">na.rm</span> <span class="kw">=</span> <span class="fl">TRUE</span>)
      ),
      <span class="fu"><a href="../reference/params.html">params</a></span>(
        <span class="kw">set_values_to</span> <span class="kw">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/vars.html">vars</a></span>(<span class="kw">PARAMCD</span> <span class="kw">=</span> <span class="st">"TDURD"</span>, <span class="kw">PARCAT1</span> <span class="kw">=</span> <span class="st">"OVERALL"</span>),
        <span class="kw">input_code</span> <span class="kw">=</span> <span class="st">"DURD"</span>,
        <span class="kw">analysis_var</span> <span class="kw">=</span> <span class="no">AVAL</span>,
        <span class="kw">summary_fun</span> <span class="kw">=</span> <span class="kw">function</span>(<span class="no">x</span>) <span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span>(<span class="no">x</span>, <span class="kw">na.rm</span> <span class="kw">=</span> <span class="fl">TRUE</span>)
      ),
      <span class="fu"><a href="../reference/params.html">params</a></span>(
        <span class="kw">set_values_to</span> <span class="kw">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/vars.html">vars</a></span>(<span class="kw">PARAMCD</span> <span class="kw">=</span> <span class="st">"TADJ"</span>, <span class="kw">PARCAT1</span> <span class="kw">=</span> <span class="st">"OVERALL"</span>),
        <span class="kw">input_code</span> <span class="kw">=</span> <span class="st">"ADJ"</span>,
        <span class="kw">analysis_var</span> <span class="kw">=</span> <span class="no">AVALC</span>,
        <span class="kw">summary_fun</span> <span class="kw">=</span> <span class="kw">function</span>(<span class="no">x</span>) <span class="fu"><a href="https://dplyr.tidyverse.org/reference/if_else.html">if_else</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span>(!<span class="fu"><a href="https://rdrr.io/r/base/NA.html">is.na</a></span>(<span class="no">x</span>)) <span class="kw">&gt;</span> <span class="fl">0</span>, <span class="st">"Y"</span>, <span class="fl">NA_character_</span>)
      ),
      <span class="fu"><a href="../reference/params.html">params</a></span>(
        <span class="kw">set_values_to</span> <span class="kw">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/vars.html">vars</a></span>(<span class="kw">PARAMCD</span> <span class="kw">=</span> <span class="st">"TADJAE"</span>, <span class="kw">PARCAT1</span> <span class="kw">=</span> <span class="st">"OVERALL"</span>),
        <span class="kw">input_code</span> <span class="kw">=</span> <span class="st">"ADJAE"</span>,
        <span class="kw">analysis_var</span> <span class="kw">=</span> <span class="no">AVALC</span>,
        <span class="kw">summary_fun</span> <span class="kw">=</span> <span class="kw">function</span>(<span class="no">x</span>) <span class="fu"><a href="https://dplyr.tidyverse.org/reference/if_else.html">if_else</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span>(!<span class="fu"><a href="https://rdrr.io/r/base/NA.html">is.na</a></span>(<span class="no">x</span>)) <span class="kw">&gt;</span> <span class="fl">0</span>, <span class="st">"Y"</span>, <span class="fl">NA_character_</span>)
      )
    ),
    <span class="kw">by_vars</span> <span class="kw">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/vars.html">vars</a></span>(<span class="no">STUDYID</span>, <span class="no">USUBJID</span>, <span class="no">TRT01P</span>, <span class="no">TRT01A</span>, <span class="no">TRTSDTM</span>, <span class="no">TRTEDTM</span>, <span class="no">TRTSDT</span>, <span class="no">TRTEDT</span>)
  )

<span class="fu"><a href="https://dplyr.tidyverse.org/reference/tally.html">count</a></span>(<span class="no">adex</span>, <span class="no">PARAMCD</span>, <span class="no">PARCAT1</span>)
<span class="co">#&gt; # A tibble: 10 x 3</span>
<span class="co">#&gt;    PARAMCD PARCAT1        n</span>
<span class="co">#&gt;    &lt;chr&gt;   &lt;chr&gt;      &lt;int&gt;</span>
<span class="co">#&gt;  1 ADJ     INDIVIDUAL   591</span>
<span class="co">#&gt;  2 ADJAE   INDIVIDUAL   591</span>
<span class="co">#&gt;  3 DOSE    INDIVIDUAL   591</span>
<span class="co">#&gt;  4 DURD    INDIVIDUAL   591</span>
<span class="co">#&gt;  5 PLDOSE  INDIVIDUAL   591</span>
<span class="co">#&gt;  6 TADJ    OVERALL      254</span>
<span class="co">#&gt;  7 TADJAE  OVERALL      254</span>
<span class="co">#&gt;  8 TDOSE   OVERALL      254</span>
<span class="co">#&gt;  9 TDURD   OVERALL      254</span>
<span class="co">#&gt; 10 TPDOSE  OVERALL      254</span>
<span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span>(<span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span>(<span class="no">adex</span>, <span class="no">USUBJID</span>, <span class="no">PARAMCD</span>, <span class="no">PARCAT1</span>, <span class="no">AVALC</span>, <span class="no">AVAL</span>))
<span class="co">#&gt; # A tibble: 6 x 5</span>
<span class="co">#&gt;   USUBJID     PARAMCD PARCAT1    AVALC  AVAL</span>
<span class="co">#&gt;   &lt;chr&gt;       &lt;chr&gt;   &lt;chr&gt;      &lt;chr&gt; &lt;dbl&gt;</span>
<span class="co">#&gt; 1 01-701-1015 DURD    INDIVIDUAL &lt;NA&gt;     15</span>
<span class="co">#&gt; 2 01-701-1015 DURD    INDIVIDUAL &lt;NA&gt;    153</span>
<span class="co">#&gt; 3 01-701-1015 DURD    INDIVIDUAL &lt;NA&gt;     14</span>
<span class="co">#&gt; 4 01-701-1023 DURD    INDIVIDUAL &lt;NA&gt;     23</span>
<span class="co">#&gt; 5 01-701-1023 DURD    INDIVIDUAL &lt;NA&gt;      5</span>
<span class="co">#&gt; 6 01-701-1028 DURD    INDIVIDUAL &lt;NA&gt;     14</span></pre></body></html></div>
<p>Dose intensity can be calculated using the function <code><a href="../reference/derive_param_doseint.html">derive_param_doseint()</a></code>. The planned dose and administered dose are passed into the function and a new record is created with the dose intensity calculation.</p>
<div class="sourceCode" id="cb15"><html><body><pre class="r"><span class="no">adex</span> <span class="kw">&lt;-</span> <span class="no">adex</span> <span class="kw">%&gt;%</span>
  <span class="fu"><a href="../reference/derive_param_doseint.html">derive_param_doseint</a></span>(
    <span class="kw">by_vars</span> <span class="kw">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/vars.html">vars</a></span>(<span class="no">USUBJID</span>),
    <span class="kw">set_values_to</span> <span class="kw">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/vars.html">vars</a></span>(<span class="kw">PARAMCD</span> <span class="kw">=</span> <span class="st">"TNDOSINT"</span>),
    <span class="kw">tadm_code</span> <span class="kw">=</span> <span class="st">"TDOSE"</span>,
    <span class="kw">tpadm_code</span> <span class="kw">=</span> <span class="st">"TPDOSE"</span>
  )

<span class="no">adex</span> <span class="kw">%&gt;%</span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span>(<span class="no">PARAMCD</span> <span class="kw">%in%</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"TNDOSINT"</span>, <span class="st">"TDOSE"</span>, <span class="st">"TPDOSE"</span>)) <span class="kw">%&gt;%</span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span>(<span class="no">USUBJID</span>, <span class="no">PARAMCD</span>, <span class="no">AVAL</span>) <span class="kw">%&gt;%</span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/arrange.html">arrange</a></span>(<span class="no">USUBJID</span>) <span class="kw">%&gt;%</span>
  <span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span>()
<span class="co">#&gt; # A tibble: 6 x 3</span>
<span class="co">#&gt;   USUBJID     PARAMCD   AVAL</span>
<span class="co">#&gt;   &lt;chr&gt;       &lt;chr&gt;    &lt;dbl&gt;</span>
<span class="co">#&gt; 1 01-701-1015 TDOSE        0</span>
<span class="co">#&gt; 2 01-701-1015 TPDOSE       0</span>
<span class="co">#&gt; 3 01-701-1015 TNDOSINT   NaN</span>
<span class="co">#&gt; 4 01-701-1023 TDOSE        0</span>
<span class="co">#&gt; 5 01-701-1023 TPDOSE       0</span>
<span class="co">#&gt; 6 01-701-1023 TNDOSINT   NaN</span></pre></body></html></div>
<p>The default calculation for dose intensity is: Administered Doses / Planned Doses * 100.</p>
<p>Please see the <code><a href="../reference/derive_param_doseint.html">derive_param_doseint()</a></code> documentation to see how planned doses of 0 or <code>NA</code> are handled.</p>
</div>
<div id="paramcd" class="section level3">
<h3 class="hasAnchor">
<a href="#paramcd" class="anchor"></a>Assign <code>PARAMCD</code>, <code>PARAMN</code>, etc. from Reference tables</h3>
<p>To assign parameter level values such as <code>PARAM</code>, <code>PARAMN</code>, <code>PARCAT1</code>, etc., a lookup can be created to join to the source data.</p>
<p>For example, when creating <code>adex</code>, a lookup based on the ADaM <code>PARAMCD</code> value may be created:</p>
<table class="table">
<thead><tr class="header">
<th>PARAMCD</th>
<th>PARAM</th>
<th>PARAMN</th>
</tr></thead>
<tbody>
<tr class="odd">
<td>DURD</td>
<td>Study drug duration during constant dosing interval (days)</td>
<td>1</td>
</tr>
<tr class="even">
<td>DOSE</td>
<td>Dose administered during constant dosing interval (mg)</td>
<td>2</td>
</tr>
<tr class="odd">
<td>PLDOSE</td>
<td>Planned dose during constant dosing interval (mg)</td>
<td>3</td>
</tr>
<tr class="even">
<td>ADJ</td>
<td>Dose adjusted during constant dosing interval</td>
<td>4</td>
</tr>
<tr class="odd">
<td>ADJAE</td>
<td>Dose adjusted due to AE during constant dosing interval</td>
<td>5</td>
</tr>
<tr class="even">
<td>TDURD</td>
<td>Overall duration (days)</td>
<td>6</td>
</tr>
<tr class="odd">
<td>TDOSE</td>
<td>Total dose administered (mg)</td>
<td>7</td>
</tr>
<tr class="even">
<td>TPDOSE</td>
<td>Total planned dose (mg)</td>
<td>9</td>
</tr>
<tr class="odd">
<td>TADJ</td>
<td>Dose adjusted during study</td>
<td>10</td>
</tr>
<tr class="even">
<td>TADJAE</td>
<td>Dose adjusted during study due to AE</td>
<td>11</td>
</tr>
<tr class="odd">
<td>TNOSINT</td>
<td>Overall dose intensity (%)</td>
<td>12</td>
</tr>
</tbody>
</table>
<div class="sourceCode" id="cb16"><html><body><pre class="r"><span class="no">adex</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/join.html">left_join</a></span>(<span class="no">adex</span>, <span class="no">param_lookup</span>, <span class="kw">by</span> <span class="kw">=</span> <span class="st">"PARAMCD"</span>)

<span class="fu"><a href="https://dplyr.tidyverse.org/reference/tally.html">count</a></span>(<span class="no">adex</span>, <span class="no">PARAMCD</span>, <span class="no">PARAM</span>, <span class="no">PARAMN</span>)
<span class="co">#&gt; # A tibble: 11 x 4</span>
<span class="co">#&gt;    PARAMCD  PARAM                                                   PARAMN     n</span>
<span class="co">#&gt;    &lt;chr&gt;    &lt;chr&gt;                                                    &lt;dbl&gt; &lt;int&gt;</span>
<span class="co">#&gt;  1 ADJ      Dose adjusted during constant dosing interval                4   591</span>
<span class="co">#&gt;  2 ADJAE    Dose adjusted  due to AE during constant dosing interv…      5   591</span>
<span class="co">#&gt;  3 DOSE     Dose administered during constant dosing interval (mg)       2   591</span>
<span class="co">#&gt;  4 DURD     Study drug duration during constant dosing interval (d…      1   591</span>
<span class="co">#&gt;  5 PLDOSE   Planned dose during constant dosing interval (mg)            3   591</span>
<span class="co">#&gt;  6 TADJ     Dose adjusted during study                                  10   254</span>
<span class="co">#&gt;  7 TADJAE   Dose adjusted during study due to AE                        11   254</span>
<span class="co">#&gt;  8 TDOSE    Total dose administered (mg)                                 7   254</span>
<span class="co">#&gt;  9 TDURD    Overall duration (days)                                      6   254</span>
<span class="co">#&gt; 10 TNDOSINT Overall dose intensity (%)                                  12   254</span>
<span class="co">#&gt; 11 TPDOSE   Total planned dose (mg)                                      9   254</span></pre></body></html></div>
<p>Please note, this is an example only and additional columns may be needed for the join depending on your lookup/metadata table.</p>
</div>
<div id="aseq" class="section level3">
<h3 class="hasAnchor">
<a href="#aseq" class="anchor"></a>Assign <code>ASEQ</code>
</h3>
<p>The admiral function <code><a href="../reference/derive_obs_number.html">derive_obs_number()</a></code> can be used to derive <code>ASEQ</code>. An example call is:</p>
<div class="sourceCode" id="cb17"><html><body><pre class="r"><span class="no">adex</span> <span class="kw">&lt;-</span> <span class="fu"><a href="../reference/derive_obs_number.html">derive_obs_number</a></span>(
  <span class="no">adex</span>,
  <span class="kw">new_var</span> <span class="kw">=</span> <span class="no">ASEQ</span>,
  <span class="kw">by_vars</span> <span class="kw">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/vars.html">vars</a></span>(<span class="no">STUDYID</span>, <span class="no">USUBJID</span>),
  <span class="kw">order</span> <span class="kw">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/vars.html">vars</a></span>(<span class="no">PARAMCD</span>, <span class="no">ASTDT</span>),
  <span class="kw">check_type</span> <span class="kw">=</span> <span class="st">"error"</span>
)

<span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span>(<span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span>(<span class="no">adex</span>, <span class="no">USUBJID</span>, <span class="no">PARAMCD</span>, <span class="no">ASTDT</span>, <span class="no">ASEQ</span>))
<span class="co">#&gt; # A tibble: 6 x 4</span>
<span class="co">#&gt;   USUBJID     PARAMCD ASTDT       ASEQ</span>
<span class="co">#&gt;   &lt;chr&gt;       &lt;chr&gt;   &lt;date&gt;     &lt;int&gt;</span>
<span class="co">#&gt; 1 01-701-1015 ADJ     2014-01-02     1</span>
<span class="co">#&gt; 2 01-701-1015 ADJ     2014-01-17     2</span>
<span class="co">#&gt; 3 01-701-1015 ADJ     2014-06-19     3</span>
<span class="co">#&gt; 4 01-701-1015 ADJAE   2014-01-02     4</span>
<span class="co">#&gt; 5 01-701-1015 ADJAE   2014-01-17     5</span>
<span class="co">#&gt; 6 01-701-1015 ADJAE   2014-06-19     6</span></pre></body></html></div>
</div>
<div id="cat" class="section level3">
<h3 class="hasAnchor">
<a href="#cat" class="anchor"></a>Derive Categorization Variables (<code>AVALCATx</code>)</h3>
<p>Admiral does not currently have a generic function to aid in assigning <code>AVALCATx</code>/ <code>AVALCAxN</code> values. Below is a simple example of how these values may be assigned using the <code><a href="https://dplyr.tidyverse.org/reference/mutate.html">dplyr::mutate</a></code> function:</p>
<div class="sourceCode" id="cb18"><html><body><pre class="r"><span class="no">adex</span> <span class="kw">&lt;-</span> <span class="no">adex</span> <span class="kw">%&gt;%</span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span>(
    <span class="kw">AVALCAT</span> <span class="kw">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/case_when.html">case_when</a></span>(
      <span class="no">PARAMCD</span> <span class="kw">%in%</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"TDURD"</span>, <span class="st">"PDURD"</span>) <span class="kw">&amp;</span> <span class="no">AVAL</span> <span class="kw">&lt;</span> <span class="fl">30</span> ~ <span class="st">"&lt; 30 days"</span>,
      <span class="no">PARAMCD</span> <span class="kw">%in%</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"TDURD"</span>, <span class="st">"PDURD"</span>) <span class="kw">&amp;</span> <span class="no">AVAL</span> <span class="kw">&gt;=</span> <span class="fl">30</span> <span class="kw">&amp;</span> <span class="no">AVAL</span> <span class="kw">&lt;</span> <span class="fl">90</span> ~ <span class="st">"&gt;= 30 and &lt; 90 days"</span>,
      <span class="no">PARAMCD</span> <span class="kw">%in%</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"TDURD"</span>, <span class="st">"PDURD"</span>) <span class="kw">&amp;</span> <span class="no">AVAL</span> <span class="kw">&gt;=</span> <span class="fl">90</span> ~ <span class="st">"&gt;=90 days"</span>,
      <span class="no">PARAMCD</span> <span class="kw">%in%</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"TDOSE"</span>, <span class="st">"PDOSE"</span>) <span class="kw">&amp;</span> <span class="no">AVAL</span> <span class="kw">&lt;</span> <span class="fl">100</span> ~ <span class="st">"&lt; 100 mg"</span>,
      <span class="no">PARAMCD</span> <span class="kw">%in%</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"TDOSE"</span>, <span class="st">"PDOSE"</span>) <span class="kw">&amp;</span> <span class="no">AVAL</span> <span class="kw">&gt;=</span> <span class="fl">100</span> ~ <span class="st">"&gt;= 100 mg"</span>,
      <span class="fl">TRUE</span> ~ <span class="fl">NA_character_</span>
    )
  )

<span class="fu"><a href="https://dplyr.tidyverse.org/reference/distinct.html">distinct</a></span>(<span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span>(<span class="no">adex</span>, <span class="no">PARAMCD</span> <span class="kw">%in%</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"TDURD"</span>, <span class="st">"PDURD"</span>)), <span class="no">PARAMCD</span>, <span class="no">AVAL</span>, <span class="no">AVALCAT</span>)
<span class="co">#&gt; # A tibble: 117 x 3</span>
<span class="co">#&gt;    PARAMCD  AVAL AVALCAT            </span>
<span class="co">#&gt;    &lt;chr&gt;   &lt;dbl&gt; &lt;chr&gt;              </span>
<span class="co">#&gt;  1 TDURD     182 &gt;=90 days          </span>
<span class="co">#&gt;  2 TDURD      28 &lt; 30 days          </span>
<span class="co">#&gt;  3 TDURD     180 &gt;=90 days          </span>
<span class="co">#&gt;  4 TDURD      14 &lt; 30 days          </span>
<span class="co">#&gt;  5 TDURD     183 &gt;=90 days          </span>
<span class="co">#&gt;  6 TDURD      26 &lt; 30 days          </span>
<span class="co">#&gt;  7 TDURD     190 &gt;=90 days          </span>
<span class="co">#&gt;  8 TDURD      10 &lt; 30 days          </span>
<span class="co">#&gt;  9 TDURD      55 &gt;= 30 and &lt; 90 days</span>
<span class="co">#&gt; 10 TDURD      38 &gt;= 30 and &lt; 90 days</span>
<span class="co">#&gt; # … with 107 more rows</span></pre></body></html></div>
</div>
<div id="example" class="section level3">
<h3 class="hasAnchor">
<a href="#example" class="anchor"></a>Example Scripts</h3>
<table class="table">
<thead><tr class="header">
<th>ADaM</th>
<th>Sample Code</th>
</tr></thead>
<tbody><tr class="odd">
<td>ADEX</td>
<td><a href="https://github.com/Roche-GSK/admiral/blob/master/inst/templates/ad_adex.R" target="_blank">ad_adex.R</a></td>
</tr></tbody>
</table>
</div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p>Developed by Thomas Neitmann, Alice Ehmann, Stefan Bundfuss, Samia Kabi, Vignesh Thanikachalam, Ondrej Slama, Shimeng Huang, Robin Koeger, Gordon Miller, Teckla Akinyi, Eric Simms, Michael Thorpe, Pavan Kumar.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.5.0.</p>
</div>

      </footer>
</div>

  
<script src="https://cdnjs.cloudflare.com/ajax/libs/docsearch.js/2.6.1/docsearch.min.js" integrity="sha256-GKvGqXDznoRYHCwKXGnuchvKSwmx9SRMrZOTh2g4Sb0=" crossorigin="anonymous"></script><script>
  docsearch({
    
    
    apiKey: '2d4895759f79e89d6eb1c3b990bca6d8',
    indexName: 'roche-gsk',
    inputSelector: 'input#search-input.form-control',
    transformData: function(hits) {
      return hits.map(function (hit) {
        hit.url = updateHitURL(hit);
        return hit;
      });
    }
  });
</script>
</body>
</html>
