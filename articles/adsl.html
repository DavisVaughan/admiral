<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Creating ADSL • admiral</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png">
<link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png">
<link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png">
<link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png">
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.4.0/flatly/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Creating ADSL">
<meta property="og:description" content="admiral">
<meta property="og:image" content="/logo.png">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">admiral</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">0.2.1</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">
    <span class="fas fa fas fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../articles/admiral.html">Get started</a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/adsl.html">Creating ADSL</a>
    </li>
    <li>
      <a href="../articles/occds.html">Creating an OCCDS ADaM</a>
    </li>
    <li>
      <a href="../articles/bds_finding.html">Creating a BDS Finding ADaM</a>
    </li>
    <li>
      <a href="../articles/contributing.html">Contributing to admiral</a>
    </li>
    <li>
      <a href="../articles/faq.html">FAQ</a>
    </li>
  </ul>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/Roche-GSK/admiral/">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Creating ADSL</h1>
                        <h4 class="author">admiral team</h4>
            
            <h4 class="date">2021-07-08</h4>
      
      <small class="dont-index">Source: <a href="https://github.com/Roche-GSK/admiral/blob/master/vignettes/adsl.Rmd"><code>vignettes/adsl.Rmd</code></a></small>
      <div class="hidden name"><code>adsl.Rmd</code></div>

    </div>

    
    
<div id="introduction" class="section level1">
<h1 class="hasAnchor">
<a href="#introduction" class="anchor"></a>Introduction</h1>
<p>This article describes creating an ADSL ADaM. Examples are currently presented and tested using <code>dm</code>, <code>ex</code> , <code>ae</code>, <code>lb</code> and <code>ds</code> SDTM domains. However, other domains could be used.</p>
<p><strong>Note:</strong> <em>All examples assume CDISC SDTM and/or ADaM format as input unless otherwise specified.</em></p>
</div>
<div id="programming-flow" class="section level1">
<h1 class="hasAnchor">
<a href="#programming-flow" class="anchor"></a>Programming Flow</h1>
<ul>
<li><a href="#readdata">Read in Data</a></li>
<li><a href="#treatmentvar">Derive Treatment Variables (<code>TRT0xP</code>, <code>TRT0xA</code>)</a></li>
<li><a href="#trtdatetime">Derive/Impute Numeric Treatment Date/Time and Duration (<code>TRTSDT</code>, <code>TRTEDT</code>, <code>TRTDURD</code>)</a></li>
<li>
<a href="#disposition">Derive Disposition Variables</a>
<ul>
<li><a href="#disposition_date">Disposition Dates (e.g. <code>EOSDT</code>)</a></li>
<li><a href="#disposition_status">Disposition Status (e.g. <code>EOSTT</code>)</a></li>
<li><a href="#disposition_reason">Disposition Reason(s) (e.g. <code>DCSREAS</code>, <code>DCSREASP</code>)</a></li>
</ul>
</li>
<li>
<a href="#death">Derive Death Variables</a>
<ul>
<li><a href="#death_date">Death Date (<code>DTHDT</code>)</a></li>
<li><a href="#death_cause">Cause of Death (<code>DTHCAUS</code>)</a></li>
<li><a href="#death_other">Duration Relative to Death</a></li>
</ul>
</li>
<li><a href="#lstalvdt">Derive Last Known Date Alive (<code>LSTALVDT</code>)</a></li>
<li>
<a href="#groupings">Derive Groupings and Populations</a>
<ul>
<li><a href="#groupings_ex">Grouping (e.g. <code>AGEGR1</code>)</a></li>
<li><a href="#popflag">Population Flags (e.g. <code>SAFFL</code>)</a></li>
<li><a href="#other">Other Variables Required for Analysis</a></li>
</ul>
</li>
<li><a href="#example">Example Script</a></li>
</ul>
<div id="readdata" class="section level2">
<h2 class="hasAnchor">
<a href="#readdata" class="anchor"></a>Read in Data</h2>
<p>To start, all data frames needed for the creation of ADSL should be read into the environment. This will be a company specific process. Some of the data frames needed may be <code>dm</code>, <code>ex</code>, <code>ds</code>, <code>ae</code>, and <code>lb</code>.</p>
<p>For example purpose, the CDISC Pilot SDTM datasets—which are included in <code>{admiral}</code>—are used.</p>
<div class="sourceCode" id="cb1"><html><body><pre class="r"><span class="fu"><a href="https://rdrr.io/r/base/library.html">library</a></span>(<span class="no">dplyr</span>)
<span class="co">#&gt; </span>
<span class="co">#&gt; Attaching package: 'dplyr'</span>
<span class="co">#&gt; The following objects are masked from 'package:stats':</span>
<span class="co">#&gt; </span>
<span class="co">#&gt;     filter, lag</span>
<span class="co">#&gt; The following objects are masked from 'package:base':</span>
<span class="co">#&gt; </span>
<span class="co">#&gt;     intersect, setdiff, setequal, union</span>
<span class="fu"><a href="https://rdrr.io/r/base/library.html">library</a></span>(<span class="no">admiral</span>)
<span class="fu"><a href="https://rdrr.io/r/base/library.html">library</a></span>(<span class="no">lubridate</span>)
<span class="co">#&gt; </span>
<span class="co">#&gt; Attaching package: 'lubridate'</span>
<span class="co">#&gt; The following object is masked from 'package:base':</span>
<span class="co">#&gt; </span>
<span class="co">#&gt;     date</span>
<span class="fu"><a href="https://rdrr.io/r/base/library.html">library</a></span>(<span class="no">stringr</span>)

<span class="fu"><a href="https://rdrr.io/r/utils/data.html">data</a></span>(<span class="st">"dm"</span>)
<span class="fu"><a href="https://rdrr.io/r/utils/data.html">data</a></span>(<span class="st">"ds"</span>)
<span class="fu"><a href="https://rdrr.io/r/utils/data.html">data</a></span>(<span class="st">"ex"</span>)
<span class="fu"><a href="https://rdrr.io/r/utils/data.html">data</a></span>(<span class="st">"ae"</span>)
<span class="fu"><a href="https://rdrr.io/r/utils/data.html">data</a></span>(<span class="st">"lb"</span>)</pre></body></html></div>
<p>The <code>dm</code> domain is used as the basis for <code>ADSL</code>:</p>
<div class="sourceCode" id="cb2"><html><body><pre class="r"><span class="no">adsl</span> <span class="kw">&lt;-</span> <span class="no">dm</span>
<span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span>(<span class="no">adsl</span>)
<span class="co">#&gt; # A tibble: 6 x 25</span>
<span class="co">#&gt;   STUDYID DOMAIN USUBJID SUBJID RFSTDTC RFENDTC RFXSTDTC RFXENDTC RFICDTC</span>
<span class="co">#&gt;   &lt;chr&gt;   &lt;chr&gt;  &lt;chr&gt;   &lt;chr&gt;  &lt;chr&gt;   &lt;chr&gt;   &lt;chr&gt;    &lt;chr&gt;    &lt;chr&gt;  </span>
<span class="co">#&gt; 1 CDISCP… DM     01-701… 1015   2014-0… 2014-0… 2014-01… 2014-07… ""     </span>
<span class="co">#&gt; 2 CDISCP… DM     01-701… 1023   2012-0… 2012-0… 2012-08… 2012-09… ""     </span>
<span class="co">#&gt; 3 CDISCP… DM     01-701… 1028   2013-0… 2014-0… 2013-07… 2014-01… ""     </span>
<span class="co">#&gt; 4 CDISCP… DM     01-701… 1033   2014-0… 2014-0… 2014-03… 2014-03… ""     </span>
<span class="co">#&gt; 5 CDISCP… DM     01-701… 1034   2014-0… 2014-1… 2014-07… 2014-12… ""     </span>
<span class="co">#&gt; 6 CDISCP… DM     01-701… 1047   2013-0… 2013-0… 2013-02… 2013-03… ""     </span>
<span class="co">#&gt; # … with 16 more variables: RFPENDTC &lt;chr&gt;, DTHDTC &lt;chr&gt;, DTHFL &lt;chr&gt;,</span>
<span class="co">#&gt; #   SITEID &lt;chr&gt;, AGE &lt;dbl&gt;, AGEU &lt;chr&gt;, SEX &lt;chr&gt;, RACE &lt;chr&gt;, ETHNIC &lt;chr&gt;,</span>
<span class="co">#&gt; #   ARMCD &lt;chr&gt;, ARM &lt;chr&gt;, ACTARMCD &lt;chr&gt;, ACTARM &lt;chr&gt;, COUNTRY &lt;chr&gt;,</span>
<span class="co">#&gt; #   DMDTC &lt;chr&gt;, DMDY &lt;dbl&gt;</span></pre></body></html></div>
</div>
<div id="treatmentvar" class="section level2">
<h2 class="hasAnchor">
<a href="#treatmentvar" class="anchor"></a>Derive Treatment Variables (<code>TRT0xP</code>, <code>TRT0xA</code>)</h2>
<p>The mapping of the treatment variables is left to the ADaM programmer. An example mapping may be:</p>
<div class="sourceCode" id="cb3"><html><body><pre class="r"><span class="no">adsl</span> <span class="kw">&lt;-</span> <span class="no">dm</span> <span class="kw">%&gt;%</span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span>(<span class="kw">TRT01P</span> <span class="kw">=</span> <span class="no">ARM</span>, <span class="kw">TRT01A</span> <span class="kw">=</span> <span class="no">ACTARM</span>)</pre></body></html></div>
</div>
<div id="trtdatetime" class="section level2">
<h2 class="hasAnchor">
<a href="#trtdatetime" class="anchor"></a>Derive/Impute Numeric Treatment Date/Time and Duration (<code>TRTSDTM</code>, <code>TRTEDTM</code>, <code>TRTDURD</code>)</h2>
<p>The functions <code><a href="../reference/derive_var_trtsdtm.html">derive_var_trtsdtm()</a></code>, <code><a href="../reference/derive_var_trtedtm.html">derive_var_trtedtm()</a></code> can be used to derive the treatment start and end date/times using the <code>ex</code> domain.</p>
<p>Example calls:</p>
<div class="sourceCode" id="cb4"><html><body><pre class="r"><span class="no">adsl</span> <span class="kw">&lt;-</span> <span class="no">adsl</span> <span class="kw">%&gt;%</span>
  <span class="fu"><a href="../reference/derive_var_trtsdtm.html">derive_var_trtsdtm</a></span>(<span class="kw">dataset_ex</span> <span class="kw">=</span> <span class="no">ex</span>) <span class="kw">%&gt;%</span>
  <span class="fu"><a href="../reference/derive_var_trtedtm.html">derive_var_trtedtm</a></span>(<span class="kw">dataset_ex</span> <span class="kw">=</span> <span class="no">ex</span>)</pre></body></html></div>
<p>This call returns the original data frame with the column <code>TRTSDTM</code> and <code>TRTEDTM</code> added. The datetime variables returned can be converted to dates using the <code><a href="http://lubridate.tidyverse.org/reference/date.html">date()</a></code> function from the <code>{lubridate}</code> package.</p>
<div class="sourceCode" id="cb5"><html><body><pre class="r"><span class="no">adsl</span> <span class="kw">&lt;-</span> <span class="no">adsl</span> <span class="kw">%&gt;%</span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span>(
    <span class="kw">TRTSDT</span> <span class="kw">=</span> <span class="fu"><a href="http://lubridate.tidyverse.org/reference/date.html">date</a></span>(<span class="no">TRTSDTM</span>),
    <span class="kw">TRTEDT</span> <span class="kw">=</span> <span class="fu"><a href="http://lubridate.tidyverse.org/reference/date.html">date</a></span>(<span class="no">TRTEDTM</span>)
  )</pre></body></html></div>
<p>Now, that <code>TRTSDT</code> and <code>TRTEDT</code> are derived, the function <code>derive_var_trtdur()</code> can be used to calculate the Treatment duration (<code>TRTDURD</code>).</p>
<div class="sourceCode" id="cb6"><html><body><pre class="r"><span class="no">adsl</span> <span class="kw">&lt;-</span> <span class="no">adsl</span> <span class="kw">%&gt;%</span>
  <span class="fu"><a href="../reference/derive_var_trtdurd.html">derive_var_trtdurd</a></span>()

<span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span>(<span class="no">adsl</span> <span class="kw">%&gt;%</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span>(<span class="no">USUBJID</span>, <span class="fu"><a href="https://dplyr.tidyverse.org/reference/reexports.html">starts_with</a></span>(<span class="st">"TRT"</span>), -<span class="fu"><a href="https://dplyr.tidyverse.org/reference/reexports.html">starts_with</a></span>(<span class="st">"TRT0"</span>)))
<span class="co">#&gt; # A tibble: 6 x 6</span>
<span class="co">#&gt;   USUBJID  TRTSDTM             TRTEDTM             TRTSDT     TRTEDT     TRTDURD</span>
<span class="co">#&gt;   &lt;chr&gt;    &lt;dttm&gt;              &lt;dttm&gt;              &lt;date&gt;     &lt;date&gt;       &lt;dbl&gt;</span>
<span class="co">#&gt; 1 01-701-… 2014-01-02 00:00:00 2014-07-02 23:59:59 2014-01-02 2014-07-02     182</span>
<span class="co">#&gt; 2 01-701-… 2012-08-05 00:00:00 2012-09-01 23:59:59 2012-08-05 2012-09-01      28</span>
<span class="co">#&gt; 3 01-701-… 2013-07-19 00:00:00 2014-01-14 23:59:59 2013-07-19 2014-01-14     180</span>
<span class="co">#&gt; 4 01-701-… 2014-03-18 00:00:00 2014-03-31 23:59:59 2014-03-18 2014-03-31      14</span>
<span class="co">#&gt; 5 01-701-… 2014-07-01 00:00:00 2014-12-30 23:59:59 2014-07-01 2014-12-30     183</span>
<span class="co">#&gt; 6 01-701-… 2013-02-12 00:00:00 2013-03-09 23:59:59 2013-02-12 2013-03-09      26</span></pre></body></html></div>
</div>
<div id="disposition" class="section level2">
<h2 class="hasAnchor">
<a href="#disposition" class="anchor"></a>Derive Disposition Variables</h2>
<div id="disposition_date" class="section level3">
<h3 class="hasAnchor">
<a href="#disposition_date" class="anchor"></a>Disposition Dates (e.g. <code>EOSDT</code>)</h3>
<p>The function <code><a href="../reference/derive_disposition_dt.html">derive_disposition_dt()</a></code> can be used to derive a disposition date. The relevant disposition date (<code>ds.DSSTDTC</code>) is selected by adjusting the filter parameter.</p>
<p>To derive the End of Study date (<code>EOSDT</code>), a call could be:</p>
<div class="sourceCode" id="cb7"><html><body><pre class="r"><span class="no">adsl</span> <span class="kw">&lt;-</span> <span class="no">adsl</span> <span class="kw">%&gt;%</span>
  <span class="fu"><a href="../reference/derive_disposition_dt.html">derive_disposition_dt</a></span>(
    <span class="kw">dataset_ds</span> <span class="kw">=</span> <span class="no">ds</span>,
    <span class="kw">new_var</span> <span class="kw">=</span> <span class="no">EOSDT</span>,
    <span class="kw">dtc</span> <span class="kw">=</span> <span class="no">DSSTDTC</span>,
    <span class="kw">filter</span> <span class="kw">=</span> <span class="no">DSCAT</span> <span class="kw">==</span> <span class="st">"DISPOSITION EVENT"</span> <span class="kw">&amp;</span> <span class="no">DSDECOD</span> <span class="kw">!=</span> <span class="st">"SCREEN FAILURE"</span>,
    <span class="kw">date_imputation</span> <span class="kw">=</span> <span class="kw">NULL</span>
  )
<span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span>(<span class="no">adsl</span> <span class="kw">%&gt;%</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span>(<span class="no">USUBJID</span>, <span class="fu"><a href="https://dplyr.tidyverse.org/reference/reexports.html">starts_with</a></span>(<span class="st">"EOS"</span>)))
<span class="co">#&gt; # A tibble: 6 x 2</span>
<span class="co">#&gt;   USUBJID     EOSDT     </span>
<span class="co">#&gt;   &lt;chr&gt;       &lt;date&gt;    </span>
<span class="co">#&gt; 1 01-701-1015 2014-07-02</span>
<span class="co">#&gt; 2 01-701-1023 2012-09-02</span>
<span class="co">#&gt; 3 01-701-1028 2014-01-14</span>
<span class="co">#&gt; 4 01-701-1033 2014-04-14</span>
<span class="co">#&gt; 5 01-701-1034 2014-12-30</span>
<span class="co">#&gt; 6 01-701-1047 2013-03-29</span></pre></body></html></div>
<p>This call would return the input dataset with the column <code>EOSDT</code> added. This function allows the user to impute partial dates as well. If imputation is needed and the date is to be imputed to the first of the month, then set <code>date_imputation = "FIRST"</code>.</p>
</div>
<div id="disposition_status" class="section level3">
<h3 class="hasAnchor">
<a href="#disposition_status" class="anchor"></a>Disposition Status (e.g. <code>EOSTT</code>)</h3>
<p>The function <code><a href="../reference/derive_disposition_status.html">derive_disposition_status()</a></code> can be used to derive a disposition status at a specific timepoint. The relevant disposition variable (<code>ds.DSDECOD</code>) is selected by adjusting the filter parameter and used to derive <code>EOSSTT</code>.</p>
<p>To derive the End of Study status (<code>EOSSTT</code>), a call could be:</p>
<div class="sourceCode" id="cb8"><html><body><pre class="r"><span class="no">adsl</span> <span class="kw">&lt;-</span> <span class="no">adsl</span> <span class="kw">%&gt;%</span>
  <span class="fu"><a href="../reference/derive_disposition_status.html">derive_disposition_status</a></span>(
    <span class="kw">dataset_ds</span> <span class="kw">=</span> <span class="no">ds</span>,
    <span class="kw">new_var</span> <span class="kw">=</span> <span class="no">EOSSTT</span>,
    <span class="kw">status_var</span> <span class="kw">=</span> <span class="no">DSDECOD</span>,
    <span class="kw">filter</span> <span class="kw">=</span> <span class="no">DSCAT</span> <span class="kw">==</span> <span class="st">"DISPOSITION EVENT"</span>
  )
<span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span>(<span class="no">adsl</span> <span class="kw">%&gt;%</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span>(<span class="no">USUBJID</span>, <span class="fu"><a href="https://dplyr.tidyverse.org/reference/reexports.html">starts_with</a></span>(<span class="st">"EOS"</span>)))
<span class="co">#&gt; # A tibble: 6 x 3</span>
<span class="co">#&gt;   USUBJID     EOSDT      EOSSTT      </span>
<span class="co">#&gt;   &lt;chr&gt;       &lt;date&gt;     &lt;chr&gt;       </span>
<span class="co">#&gt; 1 01-701-1015 2014-07-02 COMPLETED   </span>
<span class="co">#&gt; 2 01-701-1023 2012-09-02 DISCONTINUED</span>
<span class="co">#&gt; 3 01-701-1028 2014-01-14 COMPLETED   </span>
<span class="co">#&gt; 4 01-701-1033 2014-04-14 DISCONTINUED</span>
<span class="co">#&gt; 5 01-701-1034 2014-12-30 COMPLETED   </span>
<span class="co">#&gt; 6 01-701-1047 2013-03-29 DISCONTINUED</span></pre></body></html></div>
<p>This call would return the input dataset with the column <code>EOSSTT</code> added.</p>
<p>By default, the function will derive <code>EOSSTT</code> as</p>
<ul>
<li>
<code>"COMPLETED"</code> if <code>DSDECOD == "COMPLETED"</code>
</li>
<li>
<code>"DISCONTINUED"</code> if <code>DSDECOD</code> is not <code>"COMPLETED"</code> or <code>NA</code>
</li>
<li>
<code>"ONGOING"</code> otherwise</li>
</ul>
<p>If the default derivation must be changed, the user can create his/her own function and pass it to the <code>format_new_var</code> argument of the function (<code>format_new_var = new_mapping</code>) to map <code>DSDECOD</code> to a suitable <code>EOSSTT</code> value.</p>
<p>Example function <code>format_eosstt()</code>:</p>
<div class="sourceCode" id="cb9"><html><body><pre class="r"><span class="no">format_eosstt</span> <span class="kw">&lt;-</span> <span class="kw">function</span>(<span class="no">x</span>) {
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/case_when.html">case_when</a></span>(
    <span class="no">x</span> <span class="kw">%in%</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"COMPLETED"</span>) ~ <span class="st">"COMPLETED"</span>,
    <span class="no">x</span> <span class="kw">%in%</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"SCREEN FAILURE"</span>) ~ <span class="fl">NA_character_</span>,
    !<span class="fu"><a href="https://rdrr.io/r/base/NA.html">is.na</a></span>(<span class="no">x</span>) ~ <span class="st">"DISCONTINUED"</span>,
    <span class="fl">TRUE</span> ~ <span class="st">"ONGOING"</span>
  )
}</pre></body></html></div>
<p>The customized mapping function <code>format_eosstt()</code> can now be passed to the main function:</p>
<div class="sourceCode" id="cb10"><html><body><pre class="r">
<span class="no">adsl</span> <span class="kw">&lt;-</span> <span class="no">adsl</span> <span class="kw">%&gt;%</span>
  <span class="fu"><a href="../reference/derive_disposition_status.html">derive_disposition_status</a></span>(
    <span class="kw">dataset_ds</span> <span class="kw">=</span> <span class="no">ds</span>,
    <span class="kw">new_var</span> <span class="kw">=</span> <span class="no">EOSSTT</span>,
    <span class="kw">status_var</span> <span class="kw">=</span> <span class="no">DSDECOD</span>,
    <span class="kw">format_new_var</span> <span class="kw">=</span> <span class="no">format_eosstt</span>,
    <span class="kw">filter</span> <span class="kw">=</span> <span class="no">DSCAT</span> <span class="kw">==</span> <span class="st">"DISPOSITION EVENT"</span>
  )</pre></body></html></div>
<p>This call would return the input dataset with the column <code>EOSSTT</code> added.</p>
</div>
<div id="disposition_reason" class="section level3">
<h3 class="hasAnchor">
<a href="#disposition_reason" class="anchor"></a>Disposition Reason(s) (e.g. <code>DCSREAS</code>, <code>DCSREASP</code>)</h3>
<p>The main reason for discontinuation is usually stored in <code>DSDECOD</code> while <code>DSTERM</code> provides additional details regarding subject’s discontinuation (e.g., description of <code>"OTHER"</code>).</p>
<p>The function <code><a href="../reference/derive_disposition_reason.html">derive_disposition_reason()</a></code> can be used to derive a disposition reason (along with the details, if required) at a specific timepoint. The relevant disposition variable(s) (<code>ds.DSDECOD</code>, <code>ds.DSTERM</code>) are selected by adjusting the filter parameter and used to derive the main reason (and details).</p>
<p>To derive the End of Study reason(s) (<code>DCSREAS</code> and <code>DCSREASP</code>), the call would be:</p>
<div class="sourceCode" id="cb11"><html><body><pre class="r"><span class="no">adsl</span> <span class="kw">&lt;-</span> <span class="no">adsl</span> <span class="kw">%&gt;%</span>
  <span class="fu"><a href="../reference/derive_disposition_reason.html">derive_disposition_reason</a></span>(
    <span class="kw">dataset_ds</span> <span class="kw">=</span> <span class="no">ds</span>,
    <span class="kw">new_var</span> <span class="kw">=</span> <span class="no">DCSREAS</span>,
    <span class="kw">reason_var</span> <span class="kw">=</span> <span class="no">DSDECOD</span>,
    <span class="kw">new_var_spe</span> <span class="kw">=</span> <span class="no">DCSREASP</span>,
    <span class="kw">reason_var_spe</span> <span class="kw">=</span> <span class="no">DSTERM</span>,
    <span class="kw">filter</span> <span class="kw">=</span> <span class="no">DSCAT</span> <span class="kw">==</span> <span class="st">"DISPOSITION EVENT"</span> <span class="kw">&amp;</span> <span class="no">DSDECOD</span> <span class="kw">!=</span> <span class="st">"SCREEN FAILURE"</span>
  )
<span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span>(<span class="no">adsl</span> <span class="kw">%&gt;%</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span>(<span class="no">USUBJID</span>, <span class="fu"><a href="https://dplyr.tidyverse.org/reference/reexports.html">starts_with</a></span>(<span class="st">"EOS"</span>), <span class="fu"><a href="https://dplyr.tidyverse.org/reference/reexports.html">starts_with</a></span>(<span class="st">"DCSR"</span>)))
<span class="co">#&gt; # A tibble: 6 x 5</span>
<span class="co">#&gt;   USUBJID   EOSDT      EOSSTT    DCSREAS         DCSREASP                       </span>
<span class="co">#&gt;   &lt;chr&gt;     &lt;date&gt;     &lt;chr&gt;     &lt;chr&gt;           &lt;chr&gt;                          </span>
<span class="co">#&gt; 1 01-701-1… 2014-07-02 COMPLETED &lt;NA&gt;            &lt;NA&gt;                           </span>
<span class="co">#&gt; 2 01-701-1… 2012-09-02 DISCONTI… ADVERSE EVENT   ADVERSE EVENT                  </span>
<span class="co">#&gt; 3 01-701-1… 2014-01-14 COMPLETED &lt;NA&gt;            &lt;NA&gt;                           </span>
<span class="co">#&gt; 4 01-701-1… 2014-04-14 DISCONTI… STUDY TERMINAT… SPONSOR DECISION (STUDY OR PAT…</span>
<span class="co">#&gt; 5 01-701-1… 2014-12-30 COMPLETED &lt;NA&gt;            &lt;NA&gt;                           </span>
<span class="co">#&gt; 6 01-701-1… 2013-03-29 DISCONTI… ADVERSE EVENT   ADVERSE EVENT</span></pre></body></html></div>
<p>This call would return the input dataset with the column <code>DCSREAS</code> and <code>DCSREASP</code> added.</p>
<p>By default, the function will map</p>
<ul>
<li>
<code>DCSREAS</code> as <code>DSDECOD</code> if <code>DSDECOD</code> is not <code>"COMPLETED"</code> or <code>NA</code>, <code>NA</code> otherwise</li>
<li>
<code>DCSREASP</code> as <code>DSTERM</code> if <code>DSDECOD</code> is not <code>"COMPLETED"</code> or <code>NA</code>, <code>NA</code> otherwise</li>
</ul>
<p>If the default derivation must be changed, the user can create his/her own function and pass it to the <code>format_new_var</code> argument of the function (<code>format_new_var = new_mapping</code>) to map <code>DSDECOD</code> and <code>DSTERM</code> to a suitable <code>DCSREAS</code>/<code>DCSREASP</code> value.</p>
<p>Example function <code>format_dcsreas()</code>:</p>
<div class="sourceCode" id="cb12"><html><body><pre class="r"><span class="no">format_dcsreas</span> <span class="kw">&lt;-</span> <span class="kw">function</span>(<span class="no">dsdecod</span>, <span class="no">dsterm</span> <span class="kw">=</span> <span class="kw">NULL</span>) {
  <span class="no">out</span> <span class="kw">&lt;-</span> <span class="kw">if</span> (<span class="fu"><a href="https://rdrr.io/r/base/NULL.html">is.null</a></span>(<span class="no">dsterm</span>)) <span class="no">dsdecod</span> <span class="kw">else</span> <span class="no">dsterm</span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/case_when.html">case_when</a></span>(
    <span class="no">dsdecod</span> <span class="kw">%!in%</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"COMPLETED"</span>, <span class="st">"SCREEN FAILURE"</span>) <span class="kw">&amp;</span> !<span class="fu"><a href="https://rdrr.io/r/base/NA.html">is.na</a></span>(<span class="no">dsdecod</span>) ~ <span class="no">out</span>,
    <span class="fl">TRUE</span> ~ <span class="fl">NA_character_</span>
  )
}</pre></body></html></div>
<p>The customized mapping function <code>format_dcsreas()</code> can now be passed to the main function:</p>
<div class="sourceCode" id="cb13"><html><body><pre class="r"><span class="no">adsl</span> <span class="kw">&lt;-</span> <span class="no">adsl</span> <span class="kw">%&gt;%</span>
  <span class="fu"><a href="../reference/derive_disposition_reason.html">derive_disposition_reason</a></span>(
    <span class="kw">dataset_ds</span> <span class="kw">=</span> <span class="no">ds</span>,
    <span class="kw">new_var</span> <span class="kw">=</span> <span class="no">DCSREAS</span>,
    <span class="kw">reason_var</span> <span class="kw">=</span> <span class="no">DSDECOD</span>,
    <span class="kw">new_var_spe</span> <span class="kw">=</span> <span class="no">DCSREASP</span>,
    <span class="kw">reason_var_spe</span> <span class="kw">=</span> <span class="no">DSTERM</span>,
    <span class="kw">format_new_vars</span> <span class="kw">=</span> <span class="no">format_dcsreas</span>,
    <span class="kw">filter_ds</span> <span class="kw">=</span> <span class="no">DSCAT</span> <span class="kw">==</span> <span class="st">"DISPOSITION EVENT"</span>
  )</pre></body></html></div>
</div>
</div>
<div id="death" class="section level2">
<h2 class="hasAnchor">
<a href="#death" class="anchor"></a>Derive Death Variables</h2>
<div id="death_date" class="section level3">
<h3 class="hasAnchor">
<a href="#death_date" class="anchor"></a>Death Date (<code>DTHDT</code>)</h3>
<p>The function <code><a href="../reference/derive_vars_dt.html">derive_vars_dt()</a></code> can be used to derive <code>DTHDT</code>. This function allows the user to impute the date as well.</p>
<p>Example calls:</p>
<div class="sourceCode" id="cb14"><html><body><pre class="r"><span class="no">adsl</span> <span class="kw">&lt;-</span> <span class="no">adsl</span> <span class="kw">%&gt;%</span>
  <span class="fu"><a href="../reference/derive_vars_dt.html">derive_vars_dt</a></span>(
    <span class="kw">new_vars_prefix</span> <span class="kw">=</span> <span class="st">"DTH"</span>,
    <span class="kw">dtc</span> <span class="kw">=</span> <span class="no">DTHDTC</span>
  )
<span class="no">adsl</span> <span class="kw">%&gt;%</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span>(<span class="no">USUBJID</span>, <span class="fu"><a href="https://dplyr.tidyverse.org/reference/reexports.html">starts_with</a></span>(<span class="st">"DTH"</span>)) <span class="kw">%&gt;%</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span>(<span class="no">DTHFL</span> <span class="kw">==</span> <span class="st">"Y"</span>)
<span class="co">#&gt; # A tibble: 3 x 5</span>
<span class="co">#&gt;   USUBJID     DTHDTC     DTHFL DTHDT      DTHDTF</span>
<span class="co">#&gt;   &lt;chr&gt;       &lt;chr&gt;      &lt;chr&gt; &lt;date&gt;     &lt;chr&gt; </span>
<span class="co">#&gt; 1 01-701-1211 2013-01-14 Y     2013-01-14 &lt;NA&gt;  </span>
<span class="co">#&gt; 2 01-704-1445 2014-11-01 Y     2014-11-01 &lt;NA&gt;  </span>
<span class="co">#&gt; 3 01-710-1083 2013-08-02 Y     2013-08-02 &lt;NA&gt;</span></pre></body></html></div>
<p>This call would return the input dataset with the columns <code>DTHDT</code> added and, by default, the associated date imputation flag (<code>DTHDTF</code>) populated with the controlled terminology outlined in the ADaM IG for date imputations. If the imputation flag is not required, the user must set the argument <code>flag_imputation</code> to <code>FALSE</code>.</p>
<p>If imputation is needed and the date is to be imputed to the first day of the month/year the call would be:</p>
<div class="sourceCode" id="cb15"><html><body><pre class="r"><span class="no">adsl</span> <span class="kw">&lt;-</span> <span class="no">adsl</span> <span class="kw">%&gt;%</span>
  <span class="fu"><a href="../reference/derive_vars_dt.html">derive_vars_dt</a></span>(
    <span class="kw">new_vars_prefix</span> <span class="kw">=</span> <span class="st">"DTH"</span>,
    <span class="kw">dtc</span> <span class="kw">=</span> <span class="no">DTHDTC</span>,
    <span class="kw">date_imputation</span> <span class="kw">=</span> <span class="st">"FIRST"</span>
  )</pre></body></html></div>
</div>
<div id="death_cause" class="section level3">
<h3 class="hasAnchor">
<a href="#death_cause" class="anchor"></a>Cause of Death (<code>DTHCAUS</code>)</h3>
<p>The cause of death <code>DTHCAUS</code> can be derived using the function <code><a href="../reference/derive_var_dthcaus.html">derive_var_dthcaus()</a></code>.</p>
<p>Since the cause of death could be collected/mapped in different domains (e.g. <code>DS</code>, <code>AE</code>, <code>DD</code>), it is important the user specifies the right source(s) to derive the cause of death from.</p>
<p>For example, if the date of death is collected in the AE form when the AE is Fatal, the cause of death would be set to the preferred term (<code>AEDECOD</code>) of that Fatal AE, while if the date of death is collected in the <code>DS</code> form, the cause of death would be set to the disposition term (<code>DSTERM</code>). To achieve this, the <code><a href="../reference/dthcaus_source.html">dthcaus_source()</a></code> objects must be specified and defined such as it fits the study requirement.</p>
<p><code>dthcause_source()</code> specifications:</p>
<ul>
<li>
<code>dataset</code>: the dataset to search for death information,</li>
<li>
<code>filter</code>: the condition to define death,</li>
<li>
<code>date_var</code>: the date of death,</li>
<li>
<code>mode</code>: <code>first</code> or <code>last</code> to select the first/last date of death if multiple dates are collected,</li>
<li>
<code>dthcaus</code>: variable or text used to populate <code>DTHCAUS</code>.</li>
<li>
<code>traceability_vars</code>: whether the traceability variables need to be added (e.g source domain, sequence, variable)</li>
</ul>
<p>An example call to define the sources would be:</p>
<div class="sourceCode" id="cb16"><html><body><pre class="r"><span class="no">src_ae</span> <span class="kw">&lt;-</span> <span class="fu"><a href="../reference/dthcaus_source.html">dthcaus_source</a></span>(
  <span class="kw">dataset</span> <span class="kw">=</span> <span class="no">ae</span>,
  <span class="kw">filter</span> <span class="kw">=</span> <span class="no">AEOUT</span> <span class="kw">==</span> <span class="st">"FATAL"</span>,
  <span class="kw">date_var</span> <span class="kw">=</span> <span class="no">AESTDTC</span>,
  <span class="kw">mode</span> <span class="kw">=</span> <span class="st">"first"</span>,
  <span class="kw">dthcaus</span> <span class="kw">=</span> <span class="no">AEDECOD</span>
)
<span class="no">src_ds</span> <span class="kw">&lt;-</span> <span class="fu"><a href="../reference/dthcaus_source.html">dthcaus_source</a></span>(
  <span class="kw">dataset</span> <span class="kw">=</span> <span class="no">ds</span>,
  <span class="kw">filter</span> <span class="kw">=</span> <span class="no">DSDECOD</span> <span class="kw">==</span> <span class="st">"DEATH"</span> <span class="kw">&amp;</span> <span class="fu"><a href="https://rdrr.io/r/base/grep.html">grepl</a></span>(<span class="st">"DEATH DUE TO"</span>, <span class="no">DSTERM</span>),
  <span class="kw">date_var</span> <span class="kw">=</span> <span class="no">DSSTDTC</span>,
  <span class="kw">mode</span> <span class="kw">=</span> <span class="st">"first"</span>,
  <span class="kw">dthcaus</span> <span class="kw">=</span> <span class="st">"Death in DS"</span>
)</pre></body></html></div>
<p>Once the sources are defined, the function <code><a href="../reference/derive_var_dthcaus.html">derive_var_dthcaus()</a></code> can be used to derive <code>DTHCAUS</code>:</p>
<div class="sourceCode" id="cb17"><html><body><pre class="r"><span class="no">adsl</span> <span class="kw">&lt;-</span> <span class="no">adsl</span> <span class="kw">%&gt;%</span>
  <span class="fu"><a href="../reference/derive_var_dthcaus.html">derive_var_dthcaus</a></span>(<span class="no">src_ae</span>, <span class="no">src_ds</span>)
<span class="no">adsl</span> <span class="kw">%&gt;%</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span>(<span class="no">USUBJID</span>, <span class="fu"><a href="https://dplyr.tidyverse.org/reference/reexports.html">starts_with</a></span>(<span class="st">"DTH"</span>)) <span class="kw">%&gt;%</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span>(<span class="no">DTHFL</span> <span class="kw">==</span> <span class="st">"Y"</span>)
<span class="co">#&gt; # A tibble: 3 x 6</span>
<span class="co">#&gt;   USUBJID     DTHDTC     DTHFL DTHDT      DTHDTF DTHCAUS              </span>
<span class="co">#&gt;   &lt;chr&gt;       &lt;chr&gt;      &lt;chr&gt; &lt;date&gt;     &lt;chr&gt;  &lt;chr&gt;                </span>
<span class="co">#&gt; 1 01-701-1211 2013-01-14 Y     2013-01-14 &lt;NA&gt;   SUDDEN DEATH         </span>
<span class="co">#&gt; 2 01-704-1445 2014-11-01 Y     2014-11-01 &lt;NA&gt;   COMPLETED SUICIDE    </span>
<span class="co">#&gt; 3 01-710-1083 2013-08-02 Y     2013-08-02 &lt;NA&gt;   MYOCARDIAL INFARCTION</span></pre></body></html></div>
<p>The function also offers the option to add some traceability variables (e.g. <code>DTHDOM</code> would store the domain where the date of death is collected, and <code>DTHSEQ</code> would store the <code>xxSEQ</code> value of that domain). To add them, the <code>traceabilty_vars()</code> argument must be added to the <code><a href="../reference/dthcaus_source.html">dthcaus_source()</a></code> arguments:</p>
<div class="sourceCode" id="cb18"><html><body><pre class="r"><span class="no">src_ae</span> <span class="kw">&lt;-</span> <span class="fu"><a href="../reference/dthcaus_source.html">dthcaus_source</a></span>(
  <span class="kw">dataset</span> <span class="kw">=</span> <span class="no">ae</span>,
  <span class="kw">filter</span> <span class="kw">=</span> <span class="no">AEOUT</span> <span class="kw">==</span> <span class="st">"FATAL"</span>,
  <span class="kw">date_var</span> <span class="kw">=</span> <span class="no">AESTDTC</span>,
  <span class="kw">mode</span> <span class="kw">=</span> <span class="st">"first"</span>,
  <span class="kw">dthcaus</span> <span class="kw">=</span> <span class="no">AEDECOD</span>,
  <span class="kw">traceabilty_vars</span> <span class="kw">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/vars.html">vars</a></span>(<span class="kw">DTHDOM</span> <span class="kw">=</span> <span class="st">"AE"</span>, <span class="kw">DTHSEQ</span> <span class="kw">=</span> <span class="no">AESEQ</span>)
)

<span class="no">src_ds</span> <span class="kw">&lt;-</span> <span class="fu"><a href="../reference/dthcaus_source.html">dthcaus_source</a></span>(
  <span class="kw">dataset</span> <span class="kw">=</span> <span class="no">ds</span>,
  <span class="kw">filter</span> <span class="kw">=</span> <span class="no">DSDECOD</span> <span class="kw">==</span> <span class="st">"DEATH"</span> <span class="kw">&amp;</span> <span class="fu"><a href="https://rdrr.io/r/base/grep.html">grepl</a></span>(<span class="st">"DEATH DUE TO"</span>, <span class="no">DSTERM</span>),
  <span class="kw">date</span> <span class="kw">=</span> <span class="no">DSSTDTC</span>,
  <span class="kw">mode</span> <span class="kw">=</span> <span class="st">"first"</span>,
  <span class="kw">dthcaus</span> <span class="kw">=</span> <span class="no">DSTERM</span>,
  <span class="kw">traceabilty_vars</span> <span class="kw">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/vars.html">vars</a></span>(<span class="kw">DTHDOM</span> <span class="kw">=</span> <span class="st">"DS"</span>, <span class="kw">DTHSEQ</span> <span class="kw">=</span> <span class="no">DSSEQ</span>)
)
<span class="no">adsl</span> <span class="kw">&lt;-</span> <span class="no">adsl</span> <span class="kw">%&gt;%</span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span>(-<span class="no">DTHCAUS</span>) <span class="kw">%&gt;%</span> <span class="co"># remove it before deriving it again</span>
  <span class="fu"><a href="../reference/derive_var_dthcaus.html">derive_var_dthcaus</a></span>(<span class="no">src_ae</span>, <span class="no">src_ds</span>)

<span class="no">adsl</span> <span class="kw">%&gt;%</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span>(<span class="no">USUBJID</span>, <span class="fu"><a href="https://dplyr.tidyverse.org/reference/reexports.html">starts_with</a></span>(<span class="st">"DTH"</span>)) <span class="kw">%&gt;%</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span>(<span class="no">DTHFL</span> <span class="kw">==</span> <span class="st">"Y"</span>)</pre></body></html></div>
</div>
<div id="death_other" class="section level3">
<h3 class="hasAnchor">
<a href="#death_other" class="anchor"></a>Duration Relative to Death</h3>
<p>The function <code><a href="../reference/derive_duration.html">derive_duration()</a></code> can be used to derive duration relative to death like the Relative Day of Death (<code>DTHADY</code>) or the numbers of days from last dose to death (<code>LDDTHELD</code>).</p>
<p>Example calls:</p>
<ul>
<li>Relative Day of Death</li>
</ul>
<div class="sourceCode" id="cb19"><html><body><pre class="r"><span class="no">adsl</span> <span class="kw">&lt;-</span> <span class="no">adsl</span> <span class="kw">%&gt;%</span>
  <span class="fu"><a href="../reference/derive_duration.html">derive_duration</a></span>(
    <span class="kw">new_var</span> <span class="kw">=</span> <span class="no">DTHADY</span>,
    <span class="kw">start_date</span> <span class="kw">=</span> <span class="no">TRTSDT</span>,
    <span class="kw">end_date</span> <span class="kw">=</span> <span class="no">DTHDT</span>
  )</pre></body></html></div>
<ul>
<li>Elapsed Days from Last Dose to Death</li>
</ul>
<div class="sourceCode" id="cb20"><html><body><pre class="r"><span class="no">adsl</span> <span class="kw">&lt;-</span> <span class="no">adsl</span> <span class="kw">%&gt;%</span>
  <span class="fu"><a href="../reference/derive_duration.html">derive_duration</a></span>(
    <span class="kw">new_var</span> <span class="kw">=</span> <span class="no">LDDTHELD</span>,
    <span class="kw">start_date</span> <span class="kw">=</span> <span class="no">TRTEDT</span>,
    <span class="kw">end_date</span> <span class="kw">=</span> <span class="no">DTHDT</span>,
    <span class="kw">add_one</span> <span class="kw">=</span> <span class="fl">FALSE</span>
  )

<span class="no">adsl</span> <span class="kw">%&gt;%</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span>(<span class="no">USUBJID</span>, <span class="fu"><a href="https://dplyr.tidyverse.org/reference/reexports.html">starts_with</a></span>(<span class="st">"DTH"</span>), <span class="no">LDDTHELD</span>) <span class="kw">%&gt;%</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span>(<span class="no">DTHFL</span> <span class="kw">==</span> <span class="st">"Y"</span>)
<span class="co">#&gt; # A tibble: 3 x 8</span>
<span class="co">#&gt;   USUBJID    DTHDTC    DTHFL DTHDT      DTHDTF DTHCAUS           DTHADY LDDTHELD</span>
<span class="co">#&gt;   &lt;chr&gt;      &lt;chr&gt;     &lt;chr&gt; &lt;date&gt;     &lt;chr&gt;  &lt;chr&gt;              &lt;dbl&gt;    &lt;dbl&gt;</span>
<span class="co">#&gt; 1 01-701-12… 2013-01-… Y     2013-01-14 &lt;NA&gt;   SUDDEN DEATH          61        2</span>
<span class="co">#&gt; 2 01-704-14… 2014-11-… Y     2014-11-01 &lt;NA&gt;   COMPLETED SUICIDE    175        0</span>
<span class="co">#&gt; 3 01-710-10… 2013-08-… Y     2013-08-02 &lt;NA&gt;   MYOCARDIAL INFAR…     12        1</span></pre></body></html></div>
</div>
</div>
<div id="lstalvdt" class="section level2">
<h2 class="hasAnchor">
<a href="#lstalvdt" class="anchor"></a>Derive the Last Date Known Alive (<code>LSTALVDT</code>)</h2>
<p>Similarly as for the cause of death (<code>DTHCAUS</code>), the last known alive date (<code>LSTALVDT</code>) can be derived from multiples sources and the user must ensure the sources (<code>lstalvdt_source</code>) are correctly defined.</p>
<p><code><a href="../reference/lstalvdt_source.html">lstalvdt_source()</a></code> specifications:</p>
<ul>
<li>
<code>dataset</code>: the dataset to search for date information,</li>
<li>
<code>filter</code>: the filter to apply on the datasets,</li>
<li>
<code>date_var</code>: the date of interest,</li>
<li>
<code>date_imputation</code>: whether and how to impute partial dates,</li>
<li>
<code>traceability_vars</code>: whether the traceability variables need to be added (e.g source domain, sequence, variable)</li>
</ul>
<p>An example could be :</p>
<div class="sourceCode" id="cb21"><html><body><pre class="r"><span class="no">ae_src1</span> <span class="kw">&lt;-</span> <span class="fu"><a href="../reference/lstalvdt_source.html">lstalvdt_source</a></span>(
  <span class="kw">dataset</span> <span class="kw">=</span> <span class="no">ae</span>,
  <span class="kw">date_var</span> <span class="kw">=</span> <span class="no">AESTDTC</span>,
  <span class="kw">date_imputation</span> <span class="kw">=</span> <span class="st">"FIRST"</span>
)
<span class="no">ae_src2</span> <span class="kw">&lt;-</span> <span class="fu"><a href="../reference/lstalvdt_source.html">lstalvdt_source</a></span>(
  <span class="kw">dataset</span> <span class="kw">=</span> <span class="no">ae</span>,
  <span class="kw">date_var</span> <span class="kw">=</span> <span class="no">AEENDTC</span>,
  <span class="kw">date_imputation</span> <span class="kw">=</span> <span class="st">"LAST"</span>
)
<span class="no">lb_src</span> <span class="kw">&lt;-</span> <span class="fu"><a href="../reference/lstalvdt_source.html">lstalvdt_source</a></span>(
  <span class="kw">dataset</span> <span class="kw">=</span> <span class="no">lb</span>,
  <span class="kw">date_var</span> <span class="kw">=</span> <span class="no">LBDTC</span>,
  <span class="kw">filter</span> <span class="kw">=</span> <span class="fu"><a href="https://stringr.tidyverse.org/reference/str_length.html">str_length</a></span>(<span class="no">LBDTC</span>) <span class="kw">&gt;=</span> <span class="fl">10</span>
)
<span class="no">adsl_src</span> <span class="kw">&lt;-</span> <span class="fu"><a href="../reference/lstalvdt_source.html">lstalvdt_source</a></span>(
  <span class="kw">dataset</span> <span class="kw">=</span> <span class="no">adsl</span>,
  <span class="kw">date_var</span> <span class="kw">=</span> <span class="no">TRTEDT</span>
)</pre></body></html></div>
<p>Once the sources are defined, the function <code><a href="../reference/derive_var_lstalvdt.html">derive_var_lstalvdt()</a></code> can be used to derive <code>LSTALVDT</code>:</p>
<div class="sourceCode" id="cb22"><html><body><pre class="r"><span class="no">adsl</span> <span class="kw">&lt;-</span> <span class="no">adsl</span> <span class="kw">%&gt;%</span>
  <span class="fu"><a href="../reference/derive_var_lstalvdt.html">derive_var_lstalvdt</a></span>(<span class="no">ae_src1</span>, <span class="no">ae_src2</span>, <span class="no">lb_src</span>, <span class="no">adsl_src</span>)

<span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span>(<span class="no">adsl</span> <span class="kw">%&gt;%</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span>(<span class="no">USUBJID</span>, <span class="no">TRTEDT</span>, <span class="no">EOSDT</span>, <span class="no">LSTALVDT</span>))
<span class="co">#&gt; # A tibble: 6 x 4</span>
<span class="co">#&gt;   USUBJID     TRTEDT     EOSDT      LSTALVDT  </span>
<span class="co">#&gt;   &lt;chr&gt;       &lt;date&gt;     &lt;date&gt;     &lt;date&gt;    </span>
<span class="co">#&gt; 1 01-701-1015 2014-07-02 2014-07-02 2014-07-02</span>
<span class="co">#&gt; 2 01-701-1023 2012-09-01 2012-09-02 2012-09-02</span>
<span class="co">#&gt; 3 01-701-1028 2014-01-14 2014-01-14 2014-01-14</span>
<span class="co">#&gt; 4 01-701-1033 2014-03-31 2014-04-14 2014-04-14</span>
<span class="co">#&gt; 5 01-701-1034 2014-12-30 2014-12-30 2014-12-30</span>
<span class="co">#&gt; 6 01-701-1047 2013-03-09 2013-03-29 2013-04-07</span></pre></body></html></div>
<p>Similarly to <code><a href="../reference/dthcaus_source.html">dthcaus_source()</a></code>, the traceability variables can be added by specifying the <code>traceability_vars</code> argument in <code><a href="../reference/lstalvdt_source.html">lstalvdt_source()</a></code>.</p>
<div class="sourceCode" id="cb23"><html><body><pre class="r"><span class="no">ae_src1</span> <span class="kw">&lt;-</span> <span class="fu"><a href="../reference/lstalvdt_source.html">lstalvdt_source</a></span>(
  <span class="kw">dataset</span> <span class="kw">=</span> <span class="no">ae</span>,
  <span class="kw">date_var</span> <span class="kw">=</span> <span class="no">AESTDTC</span>,
  <span class="kw">date_imputation</span> <span class="kw">=</span> <span class="st">"FIRST"</span>,
  <span class="kw">traceability_vars</span> <span class="kw">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/vars.html">vars</a></span>(<span class="kw">LALVDOM</span> <span class="kw">=</span> <span class="st">"AE"</span>, <span class="kw">LALVSEQ</span> <span class="kw">=</span> <span class="no">AESEQ</span>, <span class="kw">LALVVAR</span> <span class="kw">=</span> <span class="st">"AESTDTC"</span>)
)
<span class="no">ae_src2</span> <span class="kw">&lt;-</span> <span class="fu"><a href="../reference/lstalvdt_source.html">lstalvdt_source</a></span>(
  <span class="kw">dataset</span> <span class="kw">=</span> <span class="no">ae</span>,
  <span class="kw">date_var</span> <span class="kw">=</span> <span class="no">AEENDTC</span>,
  <span class="kw">date_imputation</span> <span class="kw">=</span> <span class="st">"LAST"</span>,
  <span class="kw">traceability_vars</span> <span class="kw">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/vars.html">vars</a></span>(<span class="kw">LALVDOM</span> <span class="kw">=</span> <span class="st">"AE"</span>, <span class="kw">LALVSEQ</span> <span class="kw">=</span> <span class="no">AESEQ</span>, <span class="kw">LALVVAR</span> <span class="kw">=</span> <span class="st">"AEENDTC"</span>)
)
<span class="no">lb_src</span> <span class="kw">&lt;-</span> <span class="fu"><a href="../reference/lstalvdt_source.html">lstalvdt_source</a></span>(
  <span class="kw">dataset</span> <span class="kw">=</span> <span class="no">lb</span>,
  <span class="kw">date_var</span> <span class="kw">=</span> <span class="no">LBDTC</span>,
  <span class="kw">filter</span> <span class="kw">=</span> <span class="fu"><a href="https://stringr.tidyverse.org/reference/str_length.html">str_length</a></span>(<span class="no">LBDTC</span>) <span class="kw">&gt;=</span> <span class="fl">10</span>,
  <span class="kw">traceability_vars</span> <span class="kw">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/vars.html">vars</a></span>(<span class="kw">LALVDOM</span> <span class="kw">=</span> <span class="st">"LB"</span>, <span class="kw">LALVSEQ</span> <span class="kw">=</span> <span class="no">LBSEQ</span>, <span class="kw">LALVVAR</span> <span class="kw">=</span> <span class="st">"LBDTC"</span>)
)
<span class="no">adsl_src</span> <span class="kw">&lt;-</span> <span class="fu"><a href="../reference/lstalvdt_source.html">lstalvdt_source</a></span>(
  <span class="kw">dataset</span> <span class="kw">=</span> <span class="no">adsl</span>,
  <span class="kw">date_var</span> <span class="kw">=</span> <span class="no">TRTEDTM</span>,
  <span class="kw">traceability_vars</span> <span class="kw">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/vars.html">vars</a></span>(<span class="kw">LALVDOM</span> <span class="kw">=</span> <span class="st">"ADSL"</span>, <span class="kw">LALVSEQ</span> <span class="kw">=</span> <span class="fl">NA_integer_</span>, <span class="kw">LALVVAR</span> <span class="kw">=</span> <span class="st">"TRTEDTM"</span>)
)

<span class="no">adsl</span> <span class="kw">&lt;-</span> <span class="no">adsl</span> <span class="kw">%&gt;%</span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span>(-<span class="no">LSTALVDT</span>) <span class="kw">%&gt;%</span> <span class="co"># created in the previous call</span>
  <span class="fu"><a href="../reference/derive_var_lstalvdt.html">derive_var_lstalvdt</a></span>(<span class="no">ae_src1</span>, <span class="no">ae_src2</span>, <span class="no">lb_src</span>, <span class="no">adsl_src</span>)

<span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span>(<span class="no">adsl</span> <span class="kw">%&gt;%</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span>(<span class="no">USUBJID</span>, <span class="no">TRTEDT</span>, <span class="no">EOSDT</span>, <span class="no">LSTALVDT</span>, <span class="fu"><a href="https://dplyr.tidyverse.org/reference/reexports.html">starts_with</a></span>(<span class="st">"LAL"</span>)))
<span class="co">#&gt; # A tibble: 6 x 7</span>
<span class="co">#&gt;   USUBJID     TRTEDT     EOSDT      LSTALVDT   LALVDOM LALVSEQ LALVVAR</span>
<span class="co">#&gt;   &lt;chr&gt;       &lt;date&gt;     &lt;date&gt;     &lt;date&gt;     &lt;chr&gt;     &lt;dbl&gt; &lt;chr&gt;  </span>
<span class="co">#&gt; 1 01-701-1015 2014-07-02 2014-07-02 2014-07-02 ADSL         NA TRTEDTM</span>
<span class="co">#&gt; 2 01-701-1023 2012-09-01 2012-09-02 2012-09-02 LB          107 LBDTC  </span>
<span class="co">#&gt; 3 01-701-1028 2014-01-14 2014-01-14 2014-01-14 ADSL         NA TRTEDTM</span>
<span class="co">#&gt; 4 01-701-1033 2014-03-31 2014-04-14 2014-04-14 LB          107 LBDTC  </span>
<span class="co">#&gt; 5 01-701-1034 2014-12-30 2014-12-30 2014-12-30 ADSL         NA TRTEDTM</span>
<span class="co">#&gt; 6 01-701-1047 2013-03-09 2013-03-29 2013-04-07 LB          134 LBDTC</span></pre></body></html></div>
</div>
<div id="groupings" class="section level2">
<h2 class="hasAnchor">
<a href="#groupings" class="anchor"></a>Derive Groupings and Populations</h2>
<div id="groupings_ex" class="section level3">
<h3 class="hasAnchor">
<a href="#groupings_ex" class="anchor"></a>Grouping (e.g. <code>AGEGR1</code>)</h3>
<p>Numeric and categorical variables (<code>AGE</code>, <code>RACE</code>, <code>COUNTRY</code>, etc.) may need to be grouped to perform the required analysis. admiral does not <strong>currently</strong> have functionality to assist with the grouping. Instead, the user can create his/her own function to meet his/her study requirement.</p>
<p>For example, if</p>
<ul>
<li>
<code>AGEGR1</code> would categorize <code>AGE</code> in <code>&lt; 18</code>, <code>18-65</code>, <code>&gt;= 65</code>,</li>
<li>
<code>REGION1</code> would categorize <code>COUNTRY</code> in <code>North America</code>, <code>Rest of the World</code>,</li>
</ul>
<p>the user defined function(s) would be like:</p>
<div class="sourceCode" id="cb24"><html><body><pre class="r"><span class="no">format_agegr1</span> <span class="kw">&lt;-</span> <span class="kw">function</span>(<span class="no">x</span>) {
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/case_when.html">case_when</a></span>(
    !<span class="fu"><a href="https://rdrr.io/r/base/NA.html">is.na</a></span>(<span class="no">x</span>) <span class="kw">&amp;</span> <span class="no">x</span> <span class="kw">&lt;</span> <span class="fl">18</span> ~ <span class="st">"&lt; 18"</span>,
    <span class="no">x</span> <span class="kw">&gt;=</span> <span class="fl">18</span> <span class="kw">&amp;</span> <span class="no">x</span> <span class="kw">&lt;</span> <span class="fl">65</span> ~ <span class="st">"18 - 65"</span>,
    <span class="no">x</span> <span class="kw">&gt;=</span> <span class="fl">65</span> ~ <span class="st">"&gt;= 65"</span>,
    <span class="fl">TRUE</span> ~ <span class="fl">NA_character_</span>
  )
}

<span class="no">format_region1</span> <span class="kw">&lt;-</span> <span class="kw">function</span>(<span class="no">x</span>) {
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/case_when.html">case_when</a></span>(
    <span class="no">x</span> <span class="kw">%in%</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"CAN"</span>, <span class="st">"USA"</span>) ~ <span class="st">"North America"</span>,
    !<span class="fu"><a href="https://rdrr.io/r/base/NA.html">is.na</a></span>(<span class="no">x</span>) ~ <span class="st">"Rest of the World"</span>,
    <span class="fl">TRUE</span> ~ <span class="st">"Missing"</span>
  )
}</pre></body></html></div>
<p>These functions are then used in a <code><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate()</a></code> statement to derive the required grouping variables:</p>
<div class="sourceCode" id="cb25"><html><body><pre class="r"><span class="no">adsl</span> <span class="kw">&lt;-</span> <span class="no">adsl</span> <span class="kw">%&gt;%</span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span>(
    <span class="kw">AGEGR1</span> <span class="kw">=</span> <span class="fu">format_agegr1</span>(<span class="no">AGE</span>),
    <span class="kw">REGION1</span> <span class="kw">=</span> <span class="fu">format_region1</span>(<span class="no">COUNTRY</span>)
  )
<span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span>(<span class="no">adsl</span> <span class="kw">%&gt;%</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span>(<span class="no">USUBJID</span>, <span class="no">AGE</span>, <span class="no">SEX</span>, <span class="no">COUNTRY</span>, <span class="no">AGEGR1</span>, <span class="no">REGION1</span>))
<span class="co">#&gt; # A tibble: 6 x 6</span>
<span class="co">#&gt;   USUBJID       AGE SEX   COUNTRY AGEGR1  REGION1      </span>
<span class="co">#&gt;   &lt;chr&gt;       &lt;dbl&gt; &lt;chr&gt; &lt;chr&gt;   &lt;chr&gt;   &lt;chr&gt;        </span>
<span class="co">#&gt; 1 01-701-1015    63 F     USA     18 - 65 North America</span>
<span class="co">#&gt; 2 01-701-1023    64 M     USA     18 - 65 North America</span>
<span class="co">#&gt; 3 01-701-1028    71 M     USA     &gt;= 65   North America</span>
<span class="co">#&gt; 4 01-701-1033    74 M     USA     &gt;= 65   North America</span>
<span class="co">#&gt; 5 01-701-1034    77 F     USA     &gt;= 65   North America</span>
<span class="co">#&gt; 6 01-701-1047    85 F     USA     &gt;= 65   North America</span></pre></body></html></div>
</div>
<div id="popflag" class="section level3">
<h3 class="hasAnchor">
<a href="#popflag" class="anchor"></a>Population Flags (e.g. <code>SAFFL</code>)</h3>
<p>Since the populations flags are mainly company/study specific and that it can easily be derived using an <code><a href="https://dplyr.tidyverse.org/reference/if_else.html">if_else()</a></code> statement, admiral did not implement a functionality to assist with populations flags.</p>
<p>An example of a simple implementation could be:</p>
<div class="sourceCode" id="cb26"><html><body><pre class="r"><span class="no">adsl</span> <span class="kw">&lt;-</span> <span class="no">adsl</span> <span class="kw">%&gt;%</span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span>(
    <span class="kw">SAFFL</span> <span class="kw">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/if_else.html">if_else</a></span>(!<span class="fu"><a href="https://rdrr.io/r/base/NA.html">is.na</a></span>(<span class="no">TRTSDT</span>), <span class="st">"Y"</span>, <span class="fl">NA_character_</span>)
  )
<span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span>(<span class="no">adsl</span> <span class="kw">%&gt;%</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span>(<span class="no">USUBJID</span>, <span class="no">TRTSDT</span>, <span class="no">SAFFL</span>))
<span class="co">#&gt; # A tibble: 6 x 3</span>
<span class="co">#&gt;   USUBJID     TRTSDT     SAFFL</span>
<span class="co">#&gt;   &lt;chr&gt;       &lt;date&gt;     &lt;chr&gt;</span>
<span class="co">#&gt; 1 01-701-1015 2014-01-02 Y    </span>
<span class="co">#&gt; 2 01-701-1023 2012-08-05 Y    </span>
<span class="co">#&gt; 3 01-701-1028 2013-07-19 Y    </span>
<span class="co">#&gt; 4 01-701-1033 2014-03-18 Y    </span>
<span class="co">#&gt; 5 01-701-1034 2014-07-01 Y    </span>
<span class="co">#&gt; 6 01-701-1047 2013-02-12 Y</span></pre></body></html></div>
</div>
</div>
<div id="other" class="section level2">
<h2 class="hasAnchor">
<a href="#other" class="anchor"></a>Derive Other Variables</h2>
<p>The users can add specific code to cover their need for the analysis.</p>
</div>
<div id="attributes" class="section level2">
<h2 class="hasAnchor">
<a href="#attributes" class="anchor"></a>Add Labels and Attributes</h2>
<p>admiral does not <strong>currently</strong> support metadata integration, but the team is working on it!</p>
</div>
<div id="example" class="section level2">
<h2 class="hasAnchor">
<a href="#example" class="anchor"></a>Example Script</h2>
<table class="table">
<thead><tr class="header">
<th>ADaM</th>
<th>Sample Code</th>
</tr></thead>
<tbody><tr class="odd">
<td>ADSL</td>
<td><a href="https://github.com/Roche-GSK/admiral/blob/master/inst/example_scripts/ad_adsl.R" target="_blank">ad_adsl.R</a></td>
</tr></tbody>
</table>
</div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p>Developed by Thomas Neitmann, Alice Ehmann, Stefan Bundfuss, Samia Kabi, Vignesh Thanikachalam, Ondrej Slama, Shimeng Huang.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.5.0.</p>
</div>

      </footer>
</div>

  


  </body>
</html>
