<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Date and Time Imputation • admiral</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png">
<link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png">
<link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png">
<link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png">
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.4.0/flatly/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><!-- docsearch --><script src="../docsearch.js"></script><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/docsearch.js/2.6.3/docsearch.min.css" integrity="sha256-QOSRU/ra9ActyXkIBbiIB144aDBdtvXBcNc3OTNuX/Q=" crossorigin="anonymous">
<link href="../docsearch.css" rel="stylesheet">
<script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/jquery.mark.min.js" integrity="sha256-4HLtjeVgH0eIB3aZ9mLYF6E8oU5chNdjU6p6rrXpl9U=" crossorigin="anonymous"></script><meta property="og:title" content="Date and Time Imputation">
<meta property="og:description" content="admiral">
<meta property="og:image" content="/logo.png">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">admiral</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">0.3.0</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">
    <span class="fas fa fas fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../articles/admiral.html">Get started</a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li class="divider">
    <li class="dropdown-header">User Guides</li>
    <li>
      <a href="../articles/adsl.html">Creating ADSL</a>
    </li>
    <li>
      <a href="../articles/occds.html">Creating an OCCDS ADaM</a>
    </li>
    <li>
      <a href="../articles/bds_finding.html">Creating a BDS Finding ADaM</a>
    </li>
    <li>
      <a href="../articles/bds_exposure.html">Creating an Exposure (BDS) ADaM</a>
    </li>
    <li>
      <a href="../articles/imputation.html">Date and Time Imputation</a>
    </li>
    <li>
      <a href="../articles/faq.html">FAQ</a>
    </li>
    <li class="divider">
    <li class="dropdown-header">Developer Guides</li>
    <li>
      <a href="../articles/programming_strategy.html">Programming Strategy</a>
    </li>
    <li>
      <a href="../articles/git_usage.html">Guidance for git Usage</a>
    </li>
  </ul>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/Roche-GSK/admiral/">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
<form class="navbar-form navbar-right hidden-xs hidden-sm" role="search">
        <div class="form-group">
          <input type="search" class="form-control" name="search-input" id="search-input" placeholder="Search..." aria-label="Search for..." autocomplete="off">
</div>
      </form>
      
    </div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Date and Time Imputation</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/Roche-GSK/admiral/blob/master/vignettes/imputation.Rmd"><code>vignettes/imputation.Rmd</code></a></small>
      <div class="hidden name"><code>imputation.Rmd</code></div>

    </div>

    
    
<div id="introduction" class="section level1">
<h1 class="hasAnchor">
<a href="#introduction" class="anchor"></a>Introduction</h1>
<p>Date and time is collected in SDTM as character values using the extended <a href="https://en.wikipedia.org/wiki/ISO_8601">ISO 8601</a> format. For example, <code>"2019-10-9T13:42:00"</code>. It allows that some parts of the date or time are missing, e.g., <code>"2019-10"</code> if the day and the time is unknown.</p>
<p>The ADaM timing variables like <code>ADTM</code> (Analysis Datetime) or <code>ADY</code> (Analysis Relative Day) are numeric variables. They can be derived only if the date or datetime is complete. Therefore admiral provides imputation functions which fill in missing date or time parts according to certain imputation rules.</p>
<div id="required-packages" class="section level2">
<h2 class="hasAnchor">
<a href="#required-packages" class="anchor"></a>Required Packages</h2>
<p>The examples of this vignette require the following packages.</p>
<div class="sourceCode" id="cb1"><html><body><pre class="r"><span class="fu"><a href="https://rdrr.io/r/base/library.html">library</a></span>(<span class="no">admiral</span>)
<span class="fu"><a href="https://rdrr.io/r/base/library.html">library</a></span>(<span class="no">lubridate</span>)
<span class="fu"><a href="https://rdrr.io/r/base/library.html">library</a></span>(<span class="no">tibble</span>)
<span class="fu"><a href="https://rdrr.io/r/base/library.html">library</a></span>(<span class="no">dplyr</span>)</pre></body></html></div>
</div>
</div>
<div id="imputation-rules" class="section level1">
<h1 class="hasAnchor">
<a href="#imputation-rules" class="anchor"></a>Imputation Rules</h1>
<p>The simplest imputation rule is to set the missing parts to a fixed value. For example</p>
<div class="sourceCode" id="cb2"><html><body><pre class="r"><span class="fu"><a href="../reference/impute_dtc.html">impute_dtc</a></span>(
  <span class="st">"2019-10"</span>,
  <span class="kw">date_imputation</span> <span class="kw">=</span> <span class="st">"01-01"</span>,
  <span class="kw">time_imputation</span> <span class="kw">=</span> <span class="st">"00:00:00"</span>
)
<span class="co">#&gt; [1] "2019-10-01T00:00:00"</span></pre></body></html></div>
<p>Sometimes this does not work as it would result in invalid dates, e.g.,</p>
<div class="sourceCode" id="cb3"><html><body><pre class="r"><span class="fu"><a href="../reference/impute_dtc.html">impute_dtc</a></span>(
  <span class="st">"2019-02"</span>,
  <span class="kw">date_imputation</span> <span class="kw">=</span> <span class="st">"02-31"</span>,
  <span class="kw">time_imputation</span> <span class="kw">=</span> <span class="st">"00:00:00"</span>
)
<span class="co">#&gt; [1] "2019-02-31T00:00:00"</span></pre></body></html></div>
<p>Therefore the keywords <code>"first"</code> or <code>"last"</code> can be specified to request that missing parts are replaced by the first or last possible value:</p>
<div class="sourceCode" id="cb4"><html><body><pre class="r"><span class="fu"><a href="../reference/impute_dtc.html">impute_dtc</a></span>(
  <span class="st">"2019-02"</span>,
  <span class="kw">date_imputation</span> <span class="kw">=</span> <span class="st">"last"</span>,
  <span class="kw">time_imputation</span> <span class="kw">=</span> <span class="st">"00:00:00"</span>
)
<span class="co">#&gt; [1] "2019-02-28T00:00:00"</span></pre></body></html></div>
<div id="minimummaximum-dates" class="section level2">
<h2 class="hasAnchor">
<a href="#minimummaximum-dates" class="anchor"></a>Minimum/Maximum Dates</h2>
<p>In some scenarios the imputed date should not be before or after certain dates. For example an imputed date after data cut off date or death date is not desirable. The admiral imputation functions provide the <code>min_dates</code> and <code>max_dates</code> parameter to specify those dates. For example:</p>
<div class="sourceCode" id="cb5"><html><body><pre class="r"><span class="fu"><a href="../reference/impute_dtc.html">impute_dtc</a></span>(
  <span class="st">"2019-02"</span>,
  <span class="kw">date_imputation</span> <span class="kw">=</span> <span class="st">"last"</span>,
  <span class="kw">time_imputation</span> <span class="kw">=</span> <span class="st">"last"</span>,
  <span class="kw">max_dates</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span>(<span class="fu"><a href="http://lubridate.tidyverse.org/reference/ymd.html">ymd</a></span>(<span class="st">"2019-01-14"</span>), <span class="fu"><a href="http://lubridate.tidyverse.org/reference/ymd.html">ymd</a></span>(<span class="st">"2019-02-25"</span>))
)
<span class="co">#&gt; [1] "2019-02-25T00:00:00"</span></pre></body></html></div>
<p>It is ensured that the imputed date is not after any of the specified dates. Only dates which are in the range of possible dates of the dtc value are considered. The possible dates are defined by the missing parts of the dtc date, i.e., for “2019-02” the possible dates range from “2019-02-01” to “2019-02-28”. Thus “2019-01-14” is ignored. This ensures that the non-missing parts of the dtc date are not changed.</p>
</div>
</div>
<div id="imputation-flags" class="section level1">
<h1 class="hasAnchor">
<a href="#imputation-flags" class="anchor"></a>Imputation Flags</h1>
<p>ADaM requires that date or datetime variables for which imputation was used are accompanied by date and/or time imputation flag variables (<code>*DTF</code> and <code>*TMF</code>, e.g., <code>ADTF</code> and <code>ATMF</code> for <code>ADTM</code>). These variables indicate the highest level that was imputed, e.g., if minutes and seconds were imputed, the imputation flag is set to <code>"M"</code>. The admiral functions which derive imputed variables are also adding the corresponding imputation flag variables.</p>
</div>
<div id="imputation-functions" class="section level1">
<h1 class="hasAnchor">
<a href="#imputation-functions" class="anchor"></a>Imputation Functions</h1>
<p>admiral provides the following functions for imputation:</p>
<ul>
<li>
<code><a href="../reference/derive_vars_dt.html">derive_vars_dt()</a></code>: Adds a date variable and a date imputation flag variable (optional) based on a –DTC variable and imputation rules.</li>
<li>
<code><a href="../reference/derive_vars_dtm.html">derive_vars_dtm()</a></code>: Adds a datetime variable, a date imputation flag variable, and a time imputation flag variable (both optional) based on a –DTC variable and imputation rules.</li>
<li>
<code><a href="../reference/impute_dtc.html">impute_dtc()</a></code>: Returns a complete ISO 8601 date or <code>NA</code> based on a partial ISO 8601 date and imputation rules.</li>
<li>
<code><a href="../reference/convert_dtc_to_dt.html">convert_dtc_to_dt()</a></code>: Returns a date if the input ISO 8601 date is complete. Otherwise, <code>NA</code> is returned.</li>
<li>
<code><a href="../reference/convert_dtc_to_dtm.html">convert_dtc_to_dtm()</a></code>: Returns a datetime if the input ISO 8601 date and time is complete. Otherwise, <code>NA</code> is returned.</li>
<li>
<code><a href="../reference/compute_dtf.html">compute_dtf()</a></code>: Returns the date imputation flag.</li>
<li>
<code><a href="../reference/compute_tmf.html">compute_tmf()</a></code>: Returns the time imputation flag.</li>
</ul>
</div>
<div id="examples" class="section level1">
<h1 class="hasAnchor">
<a href="#examples" class="anchor"></a>Examples</h1>
<div id="create-an-imputed-datetime-and-date-variable-and-imputation-flag-variables" class="section level2">
<h2 class="hasAnchor">
<a href="#create-an-imputed-datetime-and-date-variable-and-imputation-flag-variables" class="anchor"></a>Create an Imputed Datetime and Date Variable and Imputation Flag Variables</h2>
<p>The <code><a href="../reference/derive_vars_dtm.html">derive_vars_dtm()</a></code> function derives an imputed datetime variable and the corresponding date and time imputation flags. The imputed date variable can be derived by a simple <code><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate()</a></code> call. It is not necessary and advisable to perform the imputation for the date variable if it was already done for the datetime variable. CDISC considers the datetime and the date variable as two representation of the same date. Thus the imputation must be the same and the imputation flags are valid for both the datetime and the date variable.</p>
<div class="sourceCode" id="cb6"><html><body><pre class="r"><span class="no">ae</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://tibble.tidyverse.org/reference/tribble.html">tribble</a></span>(
  ~<span class="no">AESTDTC</span>,
  <span class="st">"2019-08-09T12:34:56"</span>,
  <span class="st">"2019-04-12"</span>,
  <span class="st">"2010-09"</span>,
  <span class="fl">NA_character_</span>
)
<span class="no">ae</span> <span class="kw">%&gt;%</span>
  <span class="fu"><a href="../reference/derive_vars_dtm.html">derive_vars_dtm</a></span>(
    <span class="kw">dtc</span> <span class="kw">=</span> <span class="no">AESTDTC</span>,
    <span class="kw">new_vars_prefix</span> <span class="kw">=</span> <span class="st">"AST"</span>,
    <span class="kw">date_imputation</span> <span class="kw">=</span> <span class="st">"first"</span>,
    <span class="kw">time_imputation</span> <span class="kw">=</span> <span class="st">"first"</span>
  ) <span class="kw">%&gt;%</span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span>(<span class="kw">ASTDT</span> <span class="kw">=</span> <span class="fu"><a href="http://lubridate.tidyverse.org/reference/date.html">date</a></span>(<span class="no">ASTDTM</span>))
<span class="co">#&gt; # A tibble: 4 x 5</span>
<span class="co">#&gt;   AESTDTC             ASTDTM              ASTDTF ASTTMF ASTDT     </span>
<span class="co">#&gt;   &lt;chr&gt;               &lt;dttm&gt;              &lt;chr&gt;  &lt;chr&gt;  &lt;date&gt;    </span>
<span class="co">#&gt; 1 2019-08-09T12:34:56 2019-08-09 12:34:56 &lt;NA&gt;   &lt;NA&gt;   2019-08-09</span>
<span class="co">#&gt; 2 2019-04-12          2019-04-12 00:00:00 &lt;NA&gt;   H      2019-04-12</span>
<span class="co">#&gt; 3 2010-09             2010-09-01 00:00:00 D      H      2010-09-01</span>
<span class="co">#&gt; 4 &lt;NA&gt;                NA                  &lt;NA&gt;   &lt;NA&gt;   NA</span></pre></body></html></div>
</div>
<div id="create-an-imputed-date-variable-and-imputation-flag-variable" class="section level2">
<h2 class="hasAnchor">
<a href="#create-an-imputed-date-variable-and-imputation-flag-variable" class="anchor"></a>Create an Imputed Date Variable and Imputation Flag Variable</h2>
<p>If an imputed date variable without a corresponding datetime variable is required, it can be derived by the <code><a href="../reference/derive_vars_dt.html">derive_vars_dt()</a></code> function.</p>
<div class="sourceCode" id="cb7"><html><body><pre class="r"><span class="no">ae</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://tibble.tidyverse.org/reference/tribble.html">tribble</a></span>(
  ~<span class="no">AESTDTC</span>,
  <span class="st">"2019-08-09T12:34:56"</span>,
  <span class="st">"2019-04-12"</span>,
  <span class="st">"2010-09"</span>,
  <span class="fl">NA_character_</span>
)
<span class="fu"><a href="../reference/derive_vars_dt.html">derive_vars_dt</a></span>(
  <span class="no">ae</span>,
  <span class="kw">dtc</span> <span class="kw">=</span> <span class="no">AESTDTC</span>,
  <span class="kw">new_vars_prefix</span> <span class="kw">=</span> <span class="st">"AST"</span>,
  <span class="kw">date_imputation</span> <span class="kw">=</span> <span class="st">"first"</span>
)
<span class="co">#&gt; # A tibble: 4 x 3</span>
<span class="co">#&gt;   AESTDTC             ASTDT      ASTDTF</span>
<span class="co">#&gt;   &lt;chr&gt;               &lt;date&gt;     &lt;chr&gt; </span>
<span class="co">#&gt; 1 2019-08-09T12:34:56 2019-08-09 &lt;NA&gt;  </span>
<span class="co">#&gt; 2 2019-04-12          2019-04-12 &lt;NA&gt;  </span>
<span class="co">#&gt; 3 2010-09             2010-09-01 D     </span>
<span class="co">#&gt; 4 &lt;NA&gt;                NA         &lt;NA&gt;</span></pre></body></html></div>
</div>
<div id="impute-time-without-imputing-date" class="section level2">
<h2 class="hasAnchor">
<a href="#impute-time-without-imputing-date" class="anchor"></a>Impute Time without Imputing Date</h2>
<p>If the time should be imputed but not the date, the <code>date_imputation</code> parameter should be set to <code>NULL</code>. This results in <code>NA</code> if the date is partial. As no date is imputed the date imputation flag is not created.</p>
<div class="sourceCode" id="cb8"><html><body><pre class="r"><span class="no">ae</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://tibble.tidyverse.org/reference/tribble.html">tribble</a></span>(
  ~<span class="no">AESTDTC</span>,
  <span class="st">"2019-08-09T12:34:56"</span>,
  <span class="st">"2019-04-12"</span>,
  <span class="st">"2010-09"</span>,
  <span class="fl">NA_character_</span>
)
<span class="fu"><a href="../reference/derive_vars_dtm.html">derive_vars_dtm</a></span>(
  <span class="no">ae</span>,
  <span class="kw">dtc</span> <span class="kw">=</span> <span class="no">AESTDTC</span>,
  <span class="kw">new_vars_prefix</span> <span class="kw">=</span> <span class="st">"AST"</span>,
  <span class="kw">date_imputation</span> <span class="kw">=</span> <span class="kw">NULL</span>,
  <span class="kw">time_imputation</span> <span class="kw">=</span> <span class="st">"first"</span>
)
<span class="co">#&gt; # A tibble: 4 x 3</span>
<span class="co">#&gt;   AESTDTC             ASTDTM              ASTTMF</span>
<span class="co">#&gt;   &lt;chr&gt;               &lt;dttm&gt;              &lt;chr&gt; </span>
<span class="co">#&gt; 1 2019-08-09T12:34:56 2019-08-09 12:34:56 &lt;NA&gt;  </span>
<span class="co">#&gt; 2 2019-04-12          2019-04-12 00:00:00 H     </span>
<span class="co">#&gt; 3 2010-09             NA                  &lt;NA&gt;  </span>
<span class="co">#&gt; 4 &lt;NA&gt;                NA                  &lt;NA&gt;</span></pre></body></html></div>
</div>
<div id="avoid-imputed-dates-before-a-particular-date" class="section level2">
<h2 class="hasAnchor">
<a href="#avoid-imputed-dates-before-a-particular-date" class="anchor"></a>Avoid Imputed Dates Before a Particular Date</h2>
<p>Usually the adverse event start date is imputed as the earliest date of all possible dates when filling the missing parts. The result may be a date before treatment start date. This is not desirable because the adverse event would not be considered as treatment emergent and excluded from the adverse event summaries. This can be avoided by specifying the treatment start date variable (<code>TRTSDTM</code>) for the <code>min_dates</code> parameter.</p>
<p>Please note that <code>TRTSDTM</code> is used as imputed date only if the non missing date and time parts of <code>AESTDTC</code> coincide with those of <code>TRTSDTM</code>. Therefore <code>2019-10</code> is not imputed as <code>2019-11-11 12:34:56</code>. This ensures that collected information is not changed by the imputation.</p>
<div class="sourceCode" id="cb9"><html><body><pre class="r"><span class="no">ae</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://tibble.tidyverse.org/reference/tribble.html">tribble</a></span>(
  ~<span class="no">AESTDTC</span>,              ~<span class="no">TRTSDTM</span>,
  <span class="st">"2019-08-09T12:34:56"</span>, <span class="fu"><a href="http://lubridate.tidyverse.org/reference/ymd_hms.html">ymd_hms</a></span>(<span class="st">"2019-11-11T12:34:56"</span>),
  <span class="st">"2019-10"</span>,             <span class="fu"><a href="http://lubridate.tidyverse.org/reference/ymd_hms.html">ymd_hms</a></span>(<span class="st">"2019-11-11T12:34:56"</span>),
  <span class="st">"2019-11"</span>,             <span class="fu"><a href="http://lubridate.tidyverse.org/reference/ymd_hms.html">ymd_hms</a></span>(<span class="st">"2019-11-11T12:34:56"</span>),
  <span class="st">"2019-12-04"</span>,          <span class="fu"><a href="http://lubridate.tidyverse.org/reference/ymd_hms.html">ymd_hms</a></span>(<span class="st">"2019-11-11T12:34:56"</span>)
)
<span class="fu"><a href="../reference/derive_vars_dtm.html">derive_vars_dtm</a></span>(
  <span class="no">ae</span>,
  <span class="kw">dtc</span> <span class="kw">=</span> <span class="no">AESTDTC</span>,
  <span class="kw">new_vars_prefix</span> <span class="kw">=</span> <span class="st">"AST"</span>,
  <span class="kw">date_imputation</span> <span class="kw">=</span> <span class="st">"first"</span>,
  <span class="kw">time_imputation</span> <span class="kw">=</span> <span class="st">"first"</span>,
  <span class="kw">min_dates</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span>(<span class="no">TRTSDTM</span>)
)
<span class="co">#&gt; # A tibble: 4 x 5</span>
<span class="co">#&gt;   AESTDTC             TRTSDTM             ASTDTM              ASTDTF ASTTMF</span>
<span class="co">#&gt;   &lt;chr&gt;               &lt;dttm&gt;              &lt;dttm&gt;              &lt;chr&gt;  &lt;chr&gt; </span>
<span class="co">#&gt; 1 2019-08-09T12:34:56 2019-11-11 12:34:56 2019-08-09 12:34:56 &lt;NA&gt;   &lt;NA&gt;  </span>
<span class="co">#&gt; 2 2019-10             2019-11-11 12:34:56 2019-10-01 00:00:00 D      H     </span>
<span class="co">#&gt; 3 2019-11             2019-11-11 12:34:56 2019-11-11 12:34:56 D      H     </span>
<span class="co">#&gt; 4 2019-12-04          2019-11-11 12:34:56 2019-12-04 00:00:00 &lt;NA&gt;   H</span></pre></body></html></div>
</div>
<div id="avoid-imputed-dates-after-a-particular-date" class="section level2">
<h2 class="hasAnchor">
<a href="#avoid-imputed-dates-after-a-particular-date" class="anchor"></a>Avoid Imputed Dates After a Particular Date</h2>
<p>If a date is imputed as the lastest date of all possible dates when filling the missing parts, it should not result in dates after data cut off or death. This can be achieved by specifying the dates for the <code>max_dates</code> parameter.</p>
<p>Please note that non missing date parts are not changed. Thus <code>2019-12-04</code> is imputed as <code>2019-12-04 23:59:59</code> although it is after the data cut off date. It may make sense to replace it by the data cut off date but this is not part of the imputation. It should be done in a separate data cleaning or data cut off step.</p>
<div class="sourceCode" id="cb10"><html><body><pre class="r"><span class="no">ae</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://tibble.tidyverse.org/reference/tribble.html">tribble</a></span>(
  ~<span class="no">AEENDTC</span>,              ~<span class="no">DTHDT</span>,            ~<span class="no">DCUTDT</span>,
  <span class="st">"2019-08-09T12:34:56"</span>, <span class="fu"><a href="http://lubridate.tidyverse.org/reference/ymd.html">ymd</a></span>(<span class="st">"2019-11-11"</span>), <span class="fu"><a href="http://lubridate.tidyverse.org/reference/ymd.html">ymd</a></span>(<span class="st">"2019-12-02"</span>),
  <span class="st">"2019-11"</span>,             <span class="fu"><a href="http://lubridate.tidyverse.org/reference/ymd.html">ymd</a></span>(<span class="st">"2019-11-11"</span>), <span class="fu"><a href="http://lubridate.tidyverse.org/reference/ymd.html">ymd</a></span>(<span class="st">"2019-12-02"</span>),
  <span class="st">"2019-12"</span>,             <span class="fl">NA</span>,                <span class="fu"><a href="http://lubridate.tidyverse.org/reference/ymd.html">ymd</a></span>(<span class="st">"2019-12-02"</span>),
  <span class="st">"2019-12-04"</span>,          <span class="fl">NA</span>,                <span class="fu"><a href="http://lubridate.tidyverse.org/reference/ymd.html">ymd</a></span>(<span class="st">"2019-12-02"</span>)
)
<span class="fu"><a href="../reference/derive_vars_dtm.html">derive_vars_dtm</a></span>(
  <span class="no">ae</span>,
  <span class="kw">dtc</span> <span class="kw">=</span> <span class="no">AEENDTC</span>,
  <span class="kw">new_vars_prefix</span> <span class="kw">=</span> <span class="st">"AEN"</span>,
  <span class="kw">date_imputation</span> <span class="kw">=</span> <span class="st">"last"</span>,
  <span class="kw">time_imputation</span> <span class="kw">=</span> <span class="st">"last"</span>,
  <span class="kw">max_dates</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span>(<span class="no">DTHDT</span>, <span class="no">DCUTDT</span>)
)
<span class="co">#&gt; # A tibble: 4 x 6</span>
<span class="co">#&gt;   AEENDTC             DTHDT      DCUTDT     AENDTM              AENDTF AENTMF</span>
<span class="co">#&gt;   &lt;chr&gt;               &lt;date&gt;     &lt;date&gt;     &lt;dttm&gt;              &lt;chr&gt;  &lt;chr&gt; </span>
<span class="co">#&gt; 1 2019-08-09T12:34:56 2019-11-11 2019-12-02 2019-08-09 12:34:56 &lt;NA&gt;   &lt;NA&gt;  </span>
<span class="co">#&gt; 2 2019-11             2019-11-11 2019-12-02 2019-11-11 00:00:00 D      H     </span>
<span class="co">#&gt; 3 2019-12             NA         2019-12-02 2019-12-02 00:00:00 D      H     </span>
<span class="co">#&gt; 4 2019-12-04          NA         2019-12-02 2019-12-04 23:59:59 &lt;NA&gt;   H</span></pre></body></html></div>
</div>
<div id="imputation-without-creating-a-new-variable" class="section level2">
<h2 class="hasAnchor">
<a href="#imputation-without-creating-a-new-variable" class="anchor"></a>Imputation Without Creating a New Variable</h2>
<p>If imputation is required without creating a new variable the <code><a href="../reference/convert_dtc_to_dt.html">convert_dtc_to_dt()</a></code> function can be called to obtain a vector of imputed dates. It can be used for example in conditions:</p>
<div class="sourceCode" id="cb11"><html><body><pre class="r"><span class="no">mh</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://tibble.tidyverse.org/reference/tribble.html">tribble</a></span>(
  ~<span class="no">MHSTDTC</span>,     ~<span class="no">TRTSDT</span>,
  <span class="st">"2019-04"</span>,    <span class="fu"><a href="http://lubridate.tidyverse.org/reference/ymd.html">ymd</a></span>(<span class="st">"2019-04-15"</span>),
  <span class="st">"2019-04-01"</span>, <span class="fu"><a href="http://lubridate.tidyverse.org/reference/ymd.html">ymd</a></span>(<span class="st">"2019-04-15"</span>),
  <span class="st">"2019-05"</span>,    <span class="fu"><a href="http://lubridate.tidyverse.org/reference/ymd.html">ymd</a></span>(<span class="st">"2019-04-15"</span>),
  <span class="st">"2019-06-21"</span>, <span class="fu"><a href="http://lubridate.tidyverse.org/reference/ymd.html">ymd</a></span>(<span class="st">"2019-04-15"</span>)
)
<span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span>(
  <span class="no">mh</span>,
  <span class="fu"><a href="../reference/convert_dtc_to_dt.html">convert_dtc_to_dt</a></span>(<span class="no">MHSTDTC</span>, <span class="kw">date_imputation</span> <span class="kw">=</span> <span class="st">"first"</span>) <span class="kw">&lt;</span> <span class="no">TRTSDT</span>
)
<span class="co">#&gt; # A tibble: 2 x 2</span>
<span class="co">#&gt;   MHSTDTC    TRTSDT    </span>
<span class="co">#&gt;   &lt;chr&gt;      &lt;date&gt;    </span>
<span class="co">#&gt; 1 2019-04    2019-04-15</span>
<span class="co">#&gt; 2 2019-04-01 2019-04-15</span></pre></body></html></div>
</div>
<div id="using-more-than-one-imputation-rule-for-a-variable" class="section level2">
<h2 class="hasAnchor">
<a href="#using-more-than-one-imputation-rule-for-a-variable" class="anchor"></a>Using More Than One Imputation Rule for a Variable</h2>
<p>Using different imputation rules depending on the observation can be done by creating the variables with <code><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate()</a></code>. First the imputed datetime variable is created calling <code><a href="https://dplyr.tidyverse.org/reference/if_else.html">if_else()</a></code> and <code><a href="../reference/convert_dtc_to_dtm.html">convert_dtc_to_dtm()</a></code>. Then the time imputation flag is created calling <code><a href="../reference/compute_tmf.html">compute_tmf()</a></code>. Here no date imputation flag is created because no date imputation is performed (<code>date_imputation = NULL</code>).</p>
<div class="sourceCode" id="cb12"><html><body><pre class="r"><span class="no">vs</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://tibble.tidyverse.org/reference/tribble.html">tribble</a></span>(
  ~<span class="no">VSDTC</span>,                ~<span class="no">VSTPT</span>,
  <span class="st">"2019-08-09T12:34:56"</span>, <span class="fl">NA</span>,
  <span class="st">"2019-10-12"</span>,          <span class="st">"PRE-DOSE"</span>,
  <span class="st">"2019-11-10"</span>,          <span class="fl">NA</span>,
  <span class="st">"2019-12-04"</span>,          <span class="fl">NA</span>
)
<span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span>(
  <span class="no">vs</span>,
  <span class="kw">ADTM</span> <span class="kw">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/if_else.html">if_else</a></span>(
    <span class="no">VSTPT</span> <span class="kw">==</span> <span class="st">"PRE-DOSE"</span>,
    <span class="fu"><a href="../reference/convert_dtc_to_dtm.html">convert_dtc_to_dtm</a></span>(
      <span class="kw">dtc</span> <span class="kw">=</span> <span class="no">VSDTC</span>,
      <span class="kw">date_imputation</span> <span class="kw">=</span> <span class="kw">NULL</span>,
      <span class="kw">time_imputation</span> <span class="kw">=</span> <span class="st">"first"</span>
    ),
    <span class="fu"><a href="../reference/convert_dtc_to_dtm.html">convert_dtc_to_dtm</a></span>(
      <span class="kw">dtc</span> <span class="kw">=</span> <span class="no">VSDTC</span>,
      <span class="kw">date_imputation</span> <span class="kw">=</span> <span class="kw">NULL</span>,
      <span class="kw">time_imputation</span> <span class="kw">=</span> <span class="st">"last"</span>
    )
  ),
  <span class="kw">ADTMF</span> <span class="kw">=</span> <span class="fu"><a href="../reference/compute_tmf.html">compute_tmf</a></span>(
    <span class="kw">dtc</span> <span class="kw">=</span> <span class="no">VSDTC</span>,
    <span class="kw">dtm</span> <span class="kw">=</span> <span class="no">ADTM</span>
  )
)
<span class="co">#&gt; # A tibble: 4 x 4</span>
<span class="co">#&gt;   VSDTC               VSTPT    ADTM                ADTMF</span>
<span class="co">#&gt;   &lt;chr&gt;               &lt;chr&gt;    &lt;dttm&gt;              &lt;chr&gt;</span>
<span class="co">#&gt; 1 2019-08-09T12:34:56 &lt;NA&gt;     NA                  &lt;NA&gt; </span>
<span class="co">#&gt; 2 2019-10-12          PRE-DOSE 2019-10-12 00:00:00 H    </span>
<span class="co">#&gt; 3 2019-11-10          &lt;NA&gt;     NA                  &lt;NA&gt; </span>
<span class="co">#&gt; 4 2019-12-04          &lt;NA&gt;     NA                  &lt;NA&gt;</span></pre></body></html></div>
</div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p>Developed by Thomas Neitmann, Alice Ehmann, Stefan Bundfuss, Samia Kabi, Vignesh Thanikachalam, Ondrej Slama, Shimeng Huang, Robin Koeger, Gordon Miller, Teckla Akinyi, Eric Simms, Michael Thorpe, Pavan Kumar.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.5.0.</p>
</div>

      </footer>
</div>

  
<script src="https://cdnjs.cloudflare.com/ajax/libs/docsearch.js/2.6.1/docsearch.min.js" integrity="sha256-GKvGqXDznoRYHCwKXGnuchvKSwmx9SRMrZOTh2g4Sb0=" crossorigin="anonymous"></script><script>
  docsearch({
    
    
    apiKey: '2d4895759f79e89d6eb1c3b990bca6d8',
    indexName: 'roche-gsk',
    inputSelector: 'input#search-input.form-control',
    transformData: function(hits) {
      return hits.map(function (hit) {
        hit.url = updateHitURL(hit);
        return hit;
      });
    }
  });
</script>
</body>
</html>
